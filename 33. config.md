## Preface

Next.js can be configured through `next.config.js` in the root directory:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">/** @type {import(&#39;next&#39;).NextConfig} */</span>
<span class="code-block-extension-codeLine" data-line-num="2">const nextConfig = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  /* config options here */</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6">module.exports = nextConfig</span>
</code></pre>

As the file extension is `.js`, `next.config.js` is a regular Node.js module, not a JSON file. It is used during the Next.js server and build phases, and is not included in the browser build (the code is not bundled to the client).

If you need ECMAScript modules, you can use `next.config.mjs`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">/**</span>
<span class="code-block-extension-codeLine" data-line-num="2"> * @type {import(&#39;next&#39;).NextConfig}</span>
<span class="code-block-extension-codeLine" data-line-num="3"> */</span>
<span class="code-block-extension-codeLine" data-line-num="4">const nextConfig = {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  /* config options here */</span>
<span class="code-block-extension-codeLine" data-line-num="6">}</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">export default nextConfig</span>
</code></pre>

You can also use a function:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export default (phase, { defaultConfig }) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  /**</span>
<span class="code-block-extension-codeLine" data-line-num="3">   * @type {import(&#39;next&#39;).NextConfig}</span>
<span class="code-block-extension-codeLine" data-line-num="4">   */</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const nextConfig = {</span>
<span class="code-block-extension-codeLine" data-line-num="6">    /* config options here */</span>
<span class="code-block-extension-codeLine" data-line-num="7">  }</span>
<span class="code-block-extension-codeLine" data-line-num="8">  return nextConfig</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>

As of Next.js 12.1.0, you can also use an async function:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">module.exports = async (phase, { defaultConfig }) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  /**</span>
<span class="code-block-extension-codeLine" data-line-num="3">   * @type {import(&#39;next&#39;).NextConfig}</span>
<span class="code-block-extension-codeLine" data-line-num="4">   */</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const nextConfig = {</span>
<span class="code-block-extension-codeLine" data-line-num="6">    /* config options here */</span>
<span class="code-block-extension-codeLine" data-line-num="7">  }</span>
<span class="code-block-extension-codeLine" data-line-num="8">  return nextConfig</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>

Among them, `phase` represents the current context of configuration loading. By [viewing the source code](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fblob%2F5e6b008b561caf2710ab7be63320a3d549474a5b%2Fpackages%2Fnext%2Fshared%2Flib%2Fconstants.ts%23L19-L23 "https://github.com/vercel/next.js/blob/5e6b008b561caf2710ab7be63320a3d549474a5b/packages/next/shared/lib/constants.ts#L19-L23"), you can know that there are 5 values ​​of `phase`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export const PHASE_EXPORT = &#39;phase-export&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">export const PHASE_PRODUCTION_BUILD = &#39;phase-production-build&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3">export const PHASE_PRODUCTION_SERVER = &#39;phase-production-server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">export const PHASE_DEVELOPMENT_SERVER = &#39;phase-development-server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="5">export const PHASE_TEST = &#39;phase-test&#39;</span>
</code></pre>

You can import it through `next/constants` to customize the configuration according to different stages:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">const { PHASE_DEVELOPMENT_SERVER } = require(&#39;next/constants&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">module.exports = (phase, { defaultConfig }) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="4">  if (phase === PHASE_DEVELOPMENT_SERVER) {</span>
<span class="code-block-extension-codeLine" data-line-num="5">    return {</span>
<span class="code-block-extension-codeLine" data-line-num="6">      /* Place development configuration options here*/</span>
<span class="code-block-extension-codeLine" data-line-num="7">    }</span>
<span class="code-block-extension-codeLine" data-line-num="8">  }</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">  return {</span>
<span class="code-block-extension-codeLine" data-line-num="11">    /* Configuration of other stages except development stage*/</span>
<span class="code-block-extension-codeLine" data-line-num="12">  }</span>
<span class="code-block-extension-codeLine" data-line-num="13">}</span>
</code></pre>

In this example, the comment line is where you can put the configuration. In fact, Next.js defines a lot of configurations. You can check the [source code configuration file](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fblob%2Fcanary%2Fpackages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts "https://github.com/vercel/next.js/blob/canary/packages/next/src/server/config-shared.ts").

However, these configurations are not necessary, and there is no need to clearly understand the role of each configuration. Just take a general look and have an impression, and then check it in detail when you need it.

Because there are 36 configurations to be explained, the content is cumbersome and detailed, so the configuration part of `next.config.js` is divided into two parts. The previous article explains request-related headers, redirects, and rewrites. These are commonly used configurations in Next.js, and the contents have many similarities. Putting them together is convenient for analogy. The next article explains the remaining 33 configurations. Each configuration has a short content, so you only need to understand it.

Now let's start learning!

## 1. headers

### 1.1. Introduction

Headers are used to set custom HTTP headers, using the `headers` field of `next.config.js`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="4">      {</span>
<span class="code-block-extension-codeLine" data-line-num="5">        source: &#39;/about&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="7">          {</span>
<span class="code-block-extension-codeLine" data-line-num="8">            key: &#39;x-custom-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">            value: &#39;my custom header value&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">          },</span>
<span class="code-block-extension-codeLine" data-line-num="11">          {</span>
<span class="code-block-extension-codeLine" data-line-num="12">            key: &#39;x-another-custom-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">            value: &#39;my other custom header value&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="14">          },</span>
<span class="code-block-extension-codeLine" data-line-num="15">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="16">      },</span>
<span class="code-block-extension-codeLine" data-line-num="17">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="18">  },</span>
<span class="code-block-extension-codeLine" data-line-num="19">}</span>
</code></pre>

Visit `/about` at this time, and you can see:

![Screenshot 2023-11-09 3.40.56 pm.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca0818d69f76450182e9e9834080e0eb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2304&h=1528&s=400155&e=png&b=2a2a2a)

`headers` is an asynchronous function that returns an object array containing `source` and `headers` properties, where:

- `source` represents the incoming request path
- `headers` is a key and value Response header object array of the property

In addition to these two values, you can also set:

- `basePath`: `false` or `undefined`. When the value is `false`, `basePath` will not be included in the match, and can only be used for external rewrites
- `locale`: `false` or `undefined`, whether locale should be included in the match
- `has`: an object array with `type`, `key`, `value` properties
- `missing`: an object array with `type`, `key`, `value` properties

headers will be triggered before the file system (including pages and `/public` files).

Let's introduce these fields one by one with examples.

### 1.2. source

source represents the incoming request path. In addition to matching specific values, it also supports three matching modes:

#### Path matching

Normal path matching, for example, `/blog:slug` will match `/blog/hello-world` (no nested paths, that is, `/blog/hello-world/about` will not match)

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/blog/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="8">          {</span>
<span class="code-block-extension-codeLine" data-line-num="9">            key: &#39;x-slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">            value: &#39;:slug&#39;, // Matching parameters can be used in value</span>
<span class="code-block-extension-codeLine" data-line-num="11">          },</span>
<span class="code-block-extension-codeLine" data-line-num="12">          {</span>
<span class="code-block-extension-codeLine" data-line-num="13">            key: &#39;x-slug-:slug&#39;, // Matching parameters can be used in key</span>
<span class="code-block-extension-codeLine" data-line-num="14">            value: &#39;my other custom header value&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="15">          },</span>
<span class="code-block-extension-codeLine" data-line-num="16">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="17">      },</span>
<span class="code-block-extension-codeLine" data-line-num="18">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="19">  },</span>
<span class="code-block-extension-codeLine" data-line-num="20">}</span>
</code></pre>

Visit `/blog/hello-world`, you can see:

![Screenshot 2023-11-09 4.00.05.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f430b2c5e9a44a7d88dcaf32a3bdbad9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2294&h=1516&s=410172&e=png&b=2a2a2a)

But there will be no custom header when visiting `/blog/hello-world/about`.

#### Wildcard path matching

Use `*` after the parameter to achieve wildcard path matching. For example: `/blog/:slug*` will match `/blog/a/b/c/d/hello-world`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/blog/:slug*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="8">          {</span>
<span class="code-block-extension-codeLine" data-line-num="9">            key: &#39;x-slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">            value: &#39;:slug*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="11">          },</span>
<span class="code-block-extension-codeLine" data-line-num="12">          {</span>
<span class="code-block-extension-codeLine" data-line-num="13">            key: &#39;x-slug-:slug*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="14">            value: &#39;my other custom header value&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="15">          },</span>
<span class="code-block-extension-codeLine" data-line-num="16">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="17">      },</span>
<span class="code-block-extension-codeLine" data-line-num="18">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="19">  },</span>
<span class="code-block-extension-codeLine" data-line-num="20">}</span>
</code></pre>

Visit `/blog/hello-world/about`, you can see:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72fc974d27674c02a4e40057c49cc1ac~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=786&h=84&s=20629&e=png&b=282828)

Visit `/blog/hello-world` There are also:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c5756cc8262461a945a66436db9ee92~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=700&h=88&s=17996&e=png&b=282828)

#### Regular expression path matching

Regular expression matching is achieved by enclosing the regular expression in parentheses after the parameter. For example: `blog/:slug(\\d{1,})` matches `/blog/123` but not `/blog/abc`

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/blog/:post(\\d{1,})&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="8">          {</span>
<span class="code-block-extension-codeLine" data-line-num="9">            key: &#39;x-post&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">            value: &#39;:post&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="11">          },</span>
<span class="code-block-extension-codeLine" data-line-num="12">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="13">      },</span>
<span class="code-block-extension-codeLine" data-line-num="14">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="15">  },</span>
<span class="code-block-extension-codeLine" data-line-num="16">}</span>
</code></pre>

Visit `/blog/123`, and you can see:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0738859e301945d9967e538636722a43~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=402&h=52&s=7281&e=png&b=282828)

Note: These 8 characters `(`, `)`, `{`, `}`, `:`, `*`, `+`, `?` are all used for regular expression matching, so when you need to use these characters themselves, use `\\` to escape them

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        // match`/english(default)/something`</span>
<span class="code-block-extension-codeLine" data-line-num="7">        source: &#39;/english\\(default\\)/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="9">          {</span>
<span class="code-block-extension-codeLine" data-line-num="10">            key: &#39;x-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="11">            value: &#39;value&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="12">          },</span>
<span class="code-block-extension-codeLine" data-line-num="13">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="14">      },</span>
<span class="code-block-extension-codeLine" data-line-num="15">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="16">  },</span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span></code></pre>

### 1.3. headers

There is no need to say more about headers, let's talk about the headers overwriting behavior.

If two headers match the same path and set the same header key, the last header key will overwrite the previous one. For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="8">          {</span>
<span class="code-block-extension-codeLine" data-line-num="9">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">            value: &#39;there&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="11">          },</span>
<span class="code-block-extension-codeLine" data-line-num="12">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="13">      },</span>
<span class="code-block-extension-codeLine" data-line-num="14">      {</span>
<span class="code-block-extension-codeLine" data-line-num="15">        source: &#39;/hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="16">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="17">          {</span>
<span class="code-block-extension-codeLine" data-line-num="18">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="19">            value: &#39;world&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="20">          },</span>
<span class="code-block-extension-codeLine" data-line-num="21">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="22">      },</span>
<span class="code-block-extension-codeLine" data-line-num="23">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="24">  },</span>
<span class="code-block-extension-codeLine" data-line-num="25">}</span>
</code></pre>

In this example, when accessing `/hello`, it matches both `/:path*` and `/hello`, and the key values ​​of `x-hello` set for the two sources are different. Because `/hello` is the last header, the final value is `world`.

What if the same path is matched, but the set header keys do not conflict? Then both will be added. For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="4">      {</span>
<span class="code-block-extension-codeLine" data-line-num="5">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="7">          {</span>
<span class="code-block-extension-codeLine" data-line-num="8">            key: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">            value: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">          },</span>
<span class="code-block-extension-codeLine" data-line-num="11">          {</span>
<span class="code-block-extension-codeLine" data-line-num="12">            key: &#39;hello2&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">            value: &#39;hello2&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="14">          }</span>
<span class="code-block-extension-codeLine" data-line-num="15">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="16">      },</span>
<span class="code-block-extension-codeLine" data-line-num="17">      {</span>
<span class="code-block-extension-codeLine" data-line-num="18">        source: &#39;/hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="19">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="20">          {</span>
<span class="code-block-extension-codeLine" data-line-num="21">            key: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="22">            value: &#39;world&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="23">          },</span>
<span class="code-block-extension-codeLine" data-line-num="24">          {</span>
<span class="code-block-extension-codeLine" data-line-num="25">            key: &#39;hello3&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="26">            value: &#39;hello3&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="27">          },</span>
<span class="code-block-extension-codeLine" data-line-num="28">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="29">      },</span>
<span class="code-block-extension-codeLine" data-line-num="30">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="31">  },</span>
<span class="code-block-extension-codeLine" data-line-num="32">}</span>
</code></pre>

The final result is:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea5a1ecfec794a40b85c6684899f2914~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=248&h=128&s=11341&e=png&b=282828)

### 1.4. basePath

The value of `basePath` is `false` or `undefined`. When the value is `false`, `basePath` will not be included in the match. For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  basePath: &#39;/docs&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="6">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="7">      {</span>
<span class="code-block-extension-codeLine" data-line-num="8">        source: &#39;/with-basePath&#39;, // 匹配 /docs/with-basePath</span>
<span class="code-block-extension-codeLine" data-line-num="9">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="10">          {</span>
<span class="code-block-extension-codeLine" data-line-num="11">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="12">            value: &#39;world&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">          },</span>
<span class="code-block-extension-codeLine" data-line-num="14">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="15">      },</span>
<span class="code-block-extension-codeLine" data-line-num="16">      {</span>
<span class="code-block-extension-codeLine" data-line-num="17">        source: &#39;/without-basePath&#39;, // 匹配 /without-basePath</span>
<span class="code-block-extension-codeLine" data-line-num="18">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="19">          {</span>
<span class="code-block-extension-codeLine" data-line-num="20">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="21">            value: &#39;world&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="22">          },</span>
<span class="code-block-extension-codeLine" data-line-num="23">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="24">        basePath: false, // 因为设置了 false</span>
<span class="code-block-extension-codeLine" data-line-num="25">      },</span>
<span class="code-block-extension-codeLine" data-line-num="26">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="27">  },</span>
<span class="code-block-extension-codeLine" data-line-num="28">}</span>
</code></pre>

In this example, `basePath` is set to `/docs`. Normally, the source in headers will match the link composed of basePath + source, unless you set `basePath` to `false`.

### 1.5. locale

The value of `locale` is `false` or `undefined`, which determines whether locale should be included in the match. In fact, the effect is similar to basePath.

Considering that some students are not familiar with `locale`, let's briefly talk about the `locale` configuration item. The role of locale is internationalization (i18n). `next.config.js` provides i18n configuration items for Pages Router. Note that this is under Pages Router. Next.js no longer provides direct support under App Router. For details, please refer to the internationalization section of the brochure.

For example, we create a new `article.js` file in the `pages` directory:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// pages/article.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function Home() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return  <span class="xml">&lt;h1&gt;Hello Article!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

Then modify the configuration items in `next.config.js`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  i18n: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    locales: [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;, &#39;zh&#39;],</span>
<span class="code-block-extension-codeLine" data-line-num="5">    defaultLocale: &#39;zh&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">  }</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
</code></pre>

At this point, access to `/en/article`, `/fr/article`, `/de/article` will be rewritten to `/article`. Note that it is rewritten, that is, the route address remains unchanged, but the content is the content of `/article`. Accessing `/zh/article` will redirect to `/article`.

And if you create a new `article.js` file in the `app/article` directory, the file content is the same as above.

At this point, accessing `/en/article`, `/fr/article`, `/de/article` will all result in a 404 error. Accessing `/zh/article` will be rewritten to `/article`. This means that only `i18n.defaultLocale` is effective under App Router.

Okay, the basic introduction is complete, mainly to let everyone understand the role of i18n in the configuration items. Let's look at the locales settings in headers, for example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  i18n: {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    locales: [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;],</span>
<span class="code-block-extension-codeLine" data-line-num="4">    defaultLocale: &#39;en&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="5">  },</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="8">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="9">      {</span>
<span class="code-block-extension-codeLine" data-line-num="10">        //  locales</span>
<span class="code-block-extension-codeLine" data-line-num="11">        //  `/en/with-locale`、`/fr/with-locale`、`/de/with-locale`、`/with-locale` all match</span>
<span class="code-block-extension-codeLine" data-line-num="12">        source: &#39;/with-locale&#39;, </span>
<span class="code-block-extension-codeLine" data-line-num="13">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="14">          {</span>
<span class="code-block-extension-codeLine" data-line-num="15">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="16">            value: &#39;world1&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="17">          },</span>
<span class="code-block-extension-codeLine" data-line-num="18">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="19">      },</span>
<span class="code-block-extension-codeLine" data-line-num="20">      {</span>
<span class="code-block-extension-codeLine" data-line-num="21">        // Because locale is set to false, locales are not automatically processed</span>
<span class="code-block-extension-codeLine" data-line-num="22">        // only match `/nl/with-locale-manual`</span>
<span class="code-block-extension-codeLine" data-line-num="23">        source: &#39;/nl/with-locale-manual&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="24">        locale: false,</span>
<span class="code-block-extension-codeLine" data-line-num="25">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="26">          {</span>
<span class="code-block-extension-codeLine" data-line-num="27">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="28">            value: &#39;world2&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="29">          },</span>
<span class="code-block-extension-codeLine" data-line-num="30">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="31">      },</span>
<span class="code-block-extension-codeLine" data-line-num="32">      {</span>
<span class="code-block-extension-codeLine" data-line-num="33">        // matches '/' because `en` is defaultLocale</span>
<span class="code-block-extension-codeLine" data-line-num="34">        // only match `/`、`/en`</span>
<span class="code-block-extension-codeLine" data-line-num="35">        source: &#39;/en&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="36">        locale: false,</span>
<span class="code-block-extension-codeLine" data-line-num="37">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="38">          {</span>
<span class="code-block-extension-codeLine" data-line-num="39">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="40">            value: &#39;world3&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="41">          },</span>
<span class="code-block-extension-codeLine" data-line-num="42">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="43">      },</span>
<span class="code-block-extension-codeLine" data-line-num="44">      {</span>
<span class="code-block-extension-codeLine" data-line-num="45">        // transfer /(en|fr|de)/(.*) not match top</span>
<span class="code-block-extension-codeLine" data-line-num="46">        //  `/`  `/fr` both do</span't matchn>
<span class="code-block-extension-codeLine" data-line-num="47">        // If you want to match these two, you can use `/:path*`</span>
<span class="code-block-extension-codeLine" data-line-num="48">        source: &#39;/(.*)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="49">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="50">          {</span>
<span class="code-block-extension-codeLine" data-line-num="51">            key: &#39;x-hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="52">            value: &#39;world4&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="53">          },</span>
<span class="code-block-extension-codeLine" data-line-num="54">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="55">      },</span>
<span class="code-block-extension-codeLine" data-line-num="56">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="57">  },</span>
<span class="code-block-extension-codeLine" data-line-num="58">}</span>
</code></pre>

Note that although the i18n.locales configuration does not take effect under App Router, this only causes a 404 error on the page, and does not affect the processing of headers. Even if the page is 404, you can view the headers normally.

### 1.6. has and missing

`has` and `missing` are used to process headers, cookies, and request parameters in the request to see if they match certain fields, or if they do not match certain fields, and then apply the header.

For example, for a request of `/article?id=1&author=yayu`, `has` can require that a certain header must be returned only when the id parameter is equal to xxx in the request. `missing` can require that a certain header must be returned only when the id parameter is not equal to xxx in the request.

`has` and `missing` objects have the following fields:

- `type`: `String` type, value is one of `header`, `cookie`, `host`, `query`
- `key`: `String` type, key to match in the selected type (that is, the four values ​​above)
- `value`: `String` or `undefined`, the value to check. If the value is `undefiend`, no value will match. Supports using a regular expression-like string to capture special parts of the value. For example, `first-(?<paramName>.*)` is used to match `first-second`, and then `:paramName` can be used to get the value of `second`

It sounds a bit complicated, but you can understand it by looking at an example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async headers() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      // if header 中 `x-add-header` exict</span>
<span class="code-block-extension-codeLine" data-line-num="6">      // return `x-another-header` header</span>
<span class="code-block-extension-codeLine" data-line-num="7">      {</span>
<span class="code-block-extension-codeLine" data-line-num="8">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="10">          {</span>
<span class="code-block-extension-codeLine" data-line-num="11">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="12">            key: &#39;x-add-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">          },</span>
<span class="code-block-extension-codeLine" data-line-num="14">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="15">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="16">          {</span>
<span class="code-block-extension-codeLine" data-line-num="17">            key: &#39;x-another-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="18">            value: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="19">          },</span>
<span class="code-block-extension-codeLine" data-line-num="20">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="21">      },</span>
<span class="code-block-extension-codeLine" data-line-num="22">      // if header 中 `x-no-header` not exict</span>
<span class="code-block-extension-codeLine" data-line-num="23">      // return  `x-another-header` heder</span>
<span class="code-block-extension-codeLine" data-line-num="24">      {</span>
<span class="code-block-extension-codeLine" data-line-num="25">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="26">        missing: [</span>
<span class="code-block-extension-codeLine" data-line-num="27">          {</span>
<span class="code-block-extension-codeLine" data-line-num="28">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="29">            key: &#39;x-no-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="30">          },</span>
<span class="code-block-extension-codeLine" data-line-num="31">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="32">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="33">          {</span>
<span class="code-block-extension-codeLine" data-line-num="34">            key: &#39;x-another-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="35">            value: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="36">          },</span>
<span class="code-block-extension-codeLine" data-line-num="37">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="38">      },</span>
<span class="code-block-extension-codeLine" data-line-num="39">      // if source、query、cookie al  match</span>
<span class="code-block-extension-codeLine" data-line-num="40">      // return `x-authorized` </span>
<span class="code-block-extension-codeLine" data-line-num="41">      {</span>
<span class="code-block-extension-codeLine" data-line-num="42">        source: &#39;/specific/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="43">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="44">          {</span>
<span class="code-block-extension-codeLine" data-line-num="45">            type: &#39;query&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="46">            key: &#39;page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="47">            value: &#39;home&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="48">          },</span>
<span class="code-block-extension-codeLine" data-line-num="49">          {</span>
<span class="code-block-extension-codeLine" data-line-num="50">            type: &#39;cookie&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="51">            key: &#39;authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="52">            value: &#39;true&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="53">          },</span>
<span class="code-block-extension-codeLine" data-line-num="54">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="55">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="56">          {</span>
<span class="code-block-extension-codeLine" data-line-num="57">            key: &#39;x-authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="58">            value: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="59">          },</span>
<span class="code-block-extension-codeLine" data-line-num="60">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="61">      },</span>
<span class="code-block-extension-codeLine" data-line-num="62">      // header 中 `x-authorized`  yes  true</span>
<span class="code-block-extension-codeLine" data-line-num="63">      //  `x-another-header` </span>
<span class="code-block-extension-codeLine" data-line-num="64">      {</span>
<span class="code-block-extension-codeLine" data-line-num="65">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="66">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="67">          {</span>
<span class="code-block-extension-codeLine" data-line-num="68">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="69">            key: &#39;x-authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="70">            value: &#39;(?&lt;authorized&gt;yes|true)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="71">          },</span>
<span class="code-block-extension-codeLine" data-line-num="72">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="73">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="74">          {</span>
<span class="code-block-extension-codeLine" data-line-num="75">            key: &#39;x-another-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="76">            value: &#39;:authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="77">          },</span>
<span class="code-block-extension-codeLine" data-line-num="78">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="79">      },</span>
<span class="code-block-extension-codeLine" data-line-num="80">      // if host is `example.com`,</span>
<span class="code-block-extension-codeLine" data-line-num="81">      // apply header</span>
<span class="code-block-extension-codeLine" data-line-num="82">      {</span>
<span class="code-block-extension-codeLine" data-line-num="83">        source: &#39;/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="84">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="85">          {</span>
<span class="code-block-extension-codeLine" data-line-num="86">            type: &#39;host&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="87">            value: &#39;example.com&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="88">          },</span>
<span class="code-block-extension-codeLine" data-line-num="89">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="90">        headers: [</span>
<span class="code-block-extension-codeLine" data-line-num="91">          {</span>
<span class="code-block-extension-codeLine" data-line-num="92">            key: &#39;x-another-header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="93">            value: &#39;hello&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="94">          },</span>
<span class="code-block-extension-codeLine" data-line-num="95">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="96">      },</span>
<span class="code-block-extension-codeLine" data-line-num="97">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="98">  },</span>
<span class="code-block-extension-codeLine" data-line-num="99">}</span>
</code></pre>

Note that has and missing both judge the value in the request header. The four types of type are header, cookie, host, and query. The values ​​in the following figure are all headers:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f286f2e743624f39b7f0ab7678bc7a10~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1548&h=544&s=121143&e=png&b=282828)

Cookie refers to the Cookie header. Next.js has automatically parsed it, so you can directly judge the field value in Cookie:

![image (1).png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b0f0c3bde944941b01ece1cd01f43c0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1548&h=544&s=118810&e=png&b=282828)

host is the host name + port, query is the parameter. Taking `'http://user:pass@host.com:8080/p/a/t/h?query=string#hash'` as an example, the value of **host** is `host.com:8080`. **query** is `query=string`.

### 1.7. Cache-Control

You cannot set the `Cache-Control` header for pages or static resources in `next.config.js` because the header will be overwritten in production to ensure effective caching of responses and static resources.

### 1.8. Options

#### X-DNS-Prefetch-Control

The [X-DNS-Prefetch-Control](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FX-DNS-Prefetch-Control "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control") header controls the browser's DNS prefetching feature. DNS prefetching is a feature that enables the browser to actively perform domain name resolution, including all links in the document, whether it is images, CSS, or JavaScript and other user-clickable URLs.

Because prefetching is performed in the background, DNS is likely to be resolved before the corresponding object of the link appears. This can reduce the delay when the user clicks the link.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">json</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-json code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  key: &#39;X-DNS-Prefetch-Control&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  value: &#39;on&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

#### Strict-Transport-Security

[Strict-Transport-Security](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FStrict-Transport-Security "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Strict-Transport-Security")（HSTS) response header is used to inform the browser that the site should only be accessed via HTTPS, and that all future attempts to access the site using HTTP should be automatically redirected to HTTPS.

Using the following configuration, all current and future subdomains will use HTTPS with a `max-age` of 2 years:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  key: &#39;Strict-Transport-Security&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  value: &#39;max-age=63072000; includeSubDomains; preload&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

#### X-Frame-Options

[X-Frame-Options](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FX-Frame-Options "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options") HTTP response headers are used to indicate to the browser whether a page is allowed to be displayed in a `<frame>`, `<iframe>`, `<embed>`, or `<object>`. Sites can prevent clickjacking (en-US) attacks by ensuring that the website is not embedded in someone else's site.

This header has been[frame-ancestors](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FContent-Security-Policy%2Fframe-ancestors "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors") It has better support in modern browsers.

#### Permissions-Policy

[Permissions-Policy](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FPermissions-Policy "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Permissions-Policy")Response headers provide a mechanism to enable or disable browser features on this page or included iframes, formerly known as `Feature-Policy`.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">json</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-json code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  key: &#39;Permissions-Policy&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  value: &#39;camera=(), microphone=(), geolocation=(), browsing-topics=()&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

#### X-Content-Type-Options

If the `Content-Type` header is not explicitly set, [X-Content-Type-Options](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FX-Content-Type-Options "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Content-Type-Options") prevents the browser from trying to guess the content type. This can prevent XSS attacks on websites that allow users to upload and share files.

The only valid value for this header is `nosniff`.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">json</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-json code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  key: &#39;X-Content-Type-Options&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  value: &#39;nosniff&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

#### Referrer-Policy

[Referrer-Policy](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FReferrer-Policy "https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy")Controls the information carried when navigating from the current web page to another web page:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">json</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-json code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  key: &#39;Referrer-Policy&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  value: &#39;origin-when-cross-origin&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span></code></pre>

## 2. redirects

### 2.1. Introduction

Redirection, as the name implies, redirects the request path to another target path. To configure redirection, use `redirects` in `next.config.js`, as shown below:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="4">      {</span>
<span class="code-block-extension-codeLine" data-line-num="5">        source: &#39;/about&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">        destination: &#39;/&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        permanent: true,</span>
<span class="code-block-extension-codeLine" data-line-num="8">      },</span>
<span class="code-block-extension-codeLine" data-line-num="9">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="10">  },</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>

`redirects` is an asynchronous function that returns an array of objects with `source`, `destination`, and `permanent` properties, where:

- `source` represents the incoming request path
- `destination` represents the target path you redirect to
- `permanent` has a value of true or false. If true, use the 308 status code, indicating that the client or search engine permanently caches the redirect. If false, use the 307 status code to indicate that the redirect is temporarily not cached.

Why does Next.js use 307 and 308? Traditionally, 302 is used for temporary redirects and 301 for permanent redirects, but many browsers will change the redirect request method to GET, regardless of the original method. For example, if the browser sends a POST request to `/v1/users` and returns a 302 status code, the new address is `/v2/users`, then subsequent requests will be GET `/V2/users` instead of POST `/v2/users`, Next.js uses 307 temporary redirect and 308 permanent redirect status codes to show that the previously used request method is retained.

In addition to these three values, you can also set:

- `basePath`: `false` or `undefined`. When the value is `false`, the `basePath` will not be included in the match, and can only be used for external rewrites
- `locale`: `false` or `undefined`, whether locale should be included in the match
- `has`: an array of objects with `type`, `key`, `value` properties
- `missing`: an array of objects with `type`, `key`, `value` properties

The redirect will be triggered before the file system (including pages and `/public` files).

Redirects are not applied to client-side routing (`Link`, `router.push`) unless middleware is used and there is a matching path.

When redirects are applied, the parameters of the request path are also passed to the redirect target path. For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">{</span>
<span class="code-block-extension-codeLine" data-line-num="2">  source: &#39;/old-blog/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="3">  destination: &#39;/blog/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="4">  permanent: false</span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
</code></pre>

When requesting `/old-blog/post-1?hello=world`, the client will be redirected to `/blog/post-1?hello=world`.

### 2.2. source

#### Path matching

Normal path matching, for example, `/old-blog/:slug` will match `/old-blog/hello-world` (no nested paths, that is, `/old-blog/hello-world/about` will not match)

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/old-blog/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        destination: &#39;/news/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">        permanent: true,</span>
<span class="code-block-extension-codeLine" data-line-num="9">      },</span>
<span class="code-block-extension-codeLine" data-line-num="10">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="11">  },</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>

#### Wildcard path matching

Use `*` after the parameter to achieve wildcard path matching. For example: `/blog/:slug*` will match `/blog/a/b/c/d/hello-world`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/blog/:slug*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        destination: &#39;/news/:slug*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">        permanent: true,</span>
<span class="code-block-extension-codeLine" data-line-num="9">      },</span>
<span class="code-block-extension-codeLine" data-line-num="10">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="11">  },</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>

#### Regular expression path matching

Use parentheses to enclose the regular expression after the parameter to achieve regular expression matching. For example: `/post/:slug(\\d{1,})` matches `/post/123` but not `/post/abc`

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        source: &#39;/post/:slug(\\d{1,})&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="7">        destination: &#39;/news/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="9">      },</span>
<span class="code-block-extension-codeLine" data-line-num="10">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="11">  },</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>

Note: These 8 characters `(`, `)`, `{`, `}`, `:`, `*`, `+`, `?` are all used for regular expression matching, so when you need to use these characters themselves, use `\\` to escape them.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        // `/english(default)/something`</span>
<span class="code-block-extension-codeLine" data-line-num="7">        source: &#39;/english\\(default\\)/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">        destination: &#39;/en-us/:slug&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="10">      },</span>
<span class="code-block-extension-codeLine" data-line-num="11">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="12">  },</span>
<span class="code-block-extension-codeLine" data-line-num="13">}</span>
</code></pre>

### 2.3. basePath

When using `basePath`, each `source` and `destination` will automatically be prefixed with `basePath`, unless you set `basePath: false` for the redirect:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  basePath: &#39;/docs&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="6">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="7">      {</span>
<span class="code-block-extension-codeLine" data-line-num="8">        source: &#39;/with-basePath&#39;, // Automatically becomes /docs/with-basePath</span>
<span class="code-block-extension-codeLine" data-line-num="9">        destination: &#39;/another&#39;, // Automatically becomes /docs/another</span>
<span class="code-block-extension-codeLine" data-line-num="10">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="11">      },</span>
<span class="code-block-extension-codeLine" data-line-num="12">      {</span>
<span class="code-block-extension-codeLine" data-line-num="13">        // does not add /docs since basePath: false is set</span>
<span class="code-block-extension-codeLine" data-line-num="14">        source: &#39;/without-basePath&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="15">        destination: &#39;https://example.com&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="16">        basePath: false,</span>
<span class="code-block-extension-codeLine" data-line-num="17">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="18">      },</span>
<span class="code-block-extension-codeLine" data-line-num="19">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="20">  },</span>
<span class="code-block-extension-codeLine" data-line-num="21">}</span>
</code></pre>

### 2.4. locale

When using `i18n`, each `source` and `destination` will automatically be prefixed with `locales`, unless you set `locale: false` for the redirect. If you set `locale: false`, you must use a `locale` as a prefix for `source` and `destination` to match correctly. Let's look at an example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  i18n: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    locales: [&#39;en&#39;, &#39;fr&#39;, &#39;de&#39;],</span>
<span class="code-block-extension-codeLine" data-line-num="5">    defaultLocale: &#39;en&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">  },</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="10">      {</span>
<span class="code-block-extension-codeLine" data-line-num="11">        // /with-locale -&gt; /another</span>
<span class="code-block-extension-codeLine" data-line-num="12">        // /en/with-locale -&gt; /en/another</span>
<span class="code-block-extension-codeLine" data-line-num="13">        // /fr/with-locale -&gt; /fr/another</span>
<span class="code-block-extension-codeLine" data-line-num="14">        // /de/with-locale -&gt; /de/another</span>
<span class="code-block-extension-codeLine" data-line-num="15">        source: &#39;/with-locale&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="16">        destination: &#39;/another&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="17">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="18">      },</span>
<span class="code-block-extension-codeLine" data-line-num="19">      {</span>
<span class="code-block-extension-codeLine" data-line-num="20">        // </span>
<span class="code-block-extension-codeLine" data-line-num="21">        // /nl/with-locale-manual -&gt; /nl/another</span>
<span class="code-block-extension-codeLine" data-line-num="22">        source: &#39;/nl/with-locale-manual&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="23">        destination: &#39;/nl/another&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="24">        locale: false,</span>
<span class="code-block-extension-codeLine" data-line-num="25">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="26">      },</span>
<span class="code-block-extension-codeLine" data-line-num="27">      {</span>
<span class="code-block-extension-codeLine" data-line-num="28">        ;</span>
<span class="code-block-extension-codeLine" data-line-num="29">        // /en -&gt; /en/another</span>
<span class="code-block-extension-codeLine" data-line-num="30">        // / -&gt; /en/another</span>
<span class="code-block-extension-codeLine" data-line-num="31">        source: &#39;/en&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="32">        destination: &#39;/en/another&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="33">        locale: false,</span>
<span class="code-block-extension-codeLine" data-line-num="34">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="35">      },</span>
<span class="code-block-extension-codeLine" data-line-num="36">      // </span>
<span class="code-block-extension-codeLine" data-line-num="37">      // /page -&gt; /en/newpage</span>
<span class="code-block-extension-codeLine" data-line-num="38">      // /en/page -&gt; /en/newpage</span>
<span class="code-block-extension-codeLine" data-line-num="39">      // /fr/page -&gt; /fr/newpage</span>
<span class="code-block-extension-codeLine" data-line-num="40">      // /de/page -&gt; /de/newpage</span>
<span class="code-block-extension-codeLine" data-line-num="41">      {</span>
<span class="code-block-extension-codeLine" data-line-num="42">        source: &#39;/:locale/page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="43">        destination: &#39;/en/newpage&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="44">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="45">        locale: false,</span>
<span class="code-block-extension-codeLine" data-line-num="46">      },</span>
<span class="code-block-extension-codeLine" data-line-num="47">      {</span>
<span class="code-block-extension-codeLine" data-line-num="48">        //</span>
<span class="code-block-extension-codeLine" data-line-num="49">        // /page -&gt; /another2</span>
<span class="code-block-extension-codeLine" data-line-num="50">        // /fr/page -&gt; /fr/another2</span>
<span class="code-block-extension-codeLine" data-line-num="51">        //  /:path*</span>
<span class="code-block-extension-codeLine" data-line-num="52">        source: &#39;/(.*)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="53">        destination: &#39;/another2&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="54">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="55">      },</span>
<span class="code-block-extension-codeLine" data-line-num="56">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="57">  },</span>
<span class="code-block-extension-codeLine" data-line-num="58">}</span>
</code></pre>

### 2.5. has 和 missing

`has` and `missing` are used to process whether the header, cookie and request parameters in the request match certain fields, or redirect only when they do not match certain fields.

For example, for the request `/article?id=1&author=yayu`, `has` can require that the request must have an id parameter, or redirect only when the id parameter is equal to xxx. `missing` can require that the request must not have an id parameter, or redirect only when the id parameter is not equal to xxx.

`has` and `missing` objects have the following fields:

- `type`: `String` type, the value is one of `header`, `cookie`, `host`, `query`
- `key`: `String` type, the key to match in the selected type (that is, the four values ​​above)
- `value`: `String` or `undefined`, the value to be checked. If the value is `undefiend`, no value will match. Supports using a regular string to capture special parts of the value. For example, `first-(?<paramName>.*)` is used to match `first-second`, and then `:paramName` can be used to get the value of `second`

It is actually the same as headers, except that one returns the header and the other redirects.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// next.config.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">module.exports = {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  async redirects() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    return [</span>
<span class="code-block-extension-codeLine" data-line-num="5">      // ,</span>
<span class="code-block-extension-codeLine" data-line-num="6">      // </span>
<span class="code-block-extension-codeLine" data-line-num="7">      {</span>
<span class="code-block-extension-codeLine" data-line-num="8">        source: &#39;/:path((?!another-page$).*)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="10">          {</span>
<span class="code-block-extension-codeLine" data-line-num="11">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="12">            key: &#39;x-redirect-me&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">          },</span>
<span class="code-block-extension-codeLine" data-line-num="14">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="15">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="16">        destination: &#39;/another-page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="17">      },</span>
<span class="code-block-extension-codeLine" data-line-num="18">      // </span>
<span class="code-block-extension-codeLine" data-line-num="19">      // </span>
<span class="code-block-extension-codeLine" data-line-num="20">      {</span>
<span class="code-block-extension-codeLine" data-line-num="21">        source: &#39;/:path((?!another-page$).*)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="22">        missing: [</span>
<span class="code-block-extension-codeLine" data-line-num="23">          {</span>
<span class="code-block-extension-codeLine" data-line-num="24">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="25">            key: &#39;x-do-not-redirect&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="26">          },</span>
<span class="code-block-extension-codeLine" data-line-num="27">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="28">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="29">        destination: &#39;/another-page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="30">      },</span>
<span class="code-block-extension-codeLine" data-line-num="31">      // </span>
<span class="code-block-extension-codeLine" data-line-num="32">      // </span>
<span class="code-block-extension-codeLine" data-line-num="33">      {</span>
<span class="code-block-extension-codeLine" data-line-num="34">        source: &#39;/specific/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="35">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="36">          {</span>
<span class="code-block-extension-codeLine" data-line-num="37">            type: &#39;query&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="38">            key: &#39;page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="39">            value: &#39;home&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="40">          },</span>
<span class="code-block-extension-codeLine" data-line-num="41">          {</span>
<span class="code-block-extension-codeLine" data-line-num="42">            type: &#39;cookie&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="43">            key: &#39;authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="44">            value: &#39;true&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="45">          },</span>
<span class="code-block-extension-codeLine" data-line-num="46">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="47">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="48">        destination: &#39;/another/:path*&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="49">      },</span>
<span class="code-block-extension-codeLine" data-line-num="50">      // </span>
<span class="code-block-extension-codeLine" data-line-num="51">      // </span>
<span class="code-block-extension-codeLine" data-line-num="52">      {</span>
<span class="code-block-extension-codeLine" data-line-num="53">        source: &#39;/&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="54">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="55">          {</span>
<span class="code-block-extension-codeLine" data-line-num="56">            type: &#39;header&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="57">            key: &#39;x-authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="58">            value: &#39;(?&lt;authorized&gt;yes|true)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="59">          },</span>
<span class="code-block-extension-codeLine" data-line-num="60">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="61">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="62">        destination: &#39;/home?authorized=:authorized&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="63">      },</span>
<span class="code-block-extension-codeLine" data-line-num="64">      //  `example.com`,</span>
<span class="code-block-extension-codeLine" data-line-num="65">      // </span>
<span class="code-block-extension-codeLine" data-line-num="66">      {</span>
<span class="code-block-extension-codeLine" data-line-num="67">        source: &#39;/:path((?!another-page$).*)&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="68">        has: [</span>
<span class="code-block-extension-codeLine" data-line-num="69">          {</span>
<span class="code-block-extension-codeLine" data-line-num="70">            type: &#39;host&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="71">            value: &#39;example.com&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="72">          },</span>
<span class="code-block-extension-codeLine" data-line-num="73">        ],</span>
<span class="code-block-extension-codeLine" data-line-num="74">        permanent: false,</span>
<span class="code-block-extension-codeLine" data-line-num="75">        destination: &#39;/another-page&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="76">      },</span>
<span class="code-block-extension-codeLine" data-line-num="77">    ]</span>
<span class="code-block-extension-codeLine" data-line-num="78">  },</span>
<span class="code-block-extension-codeLine" data-line-num="79">}</span>
</code></pre>
