## preface

Routing handler refers to using the Web [Request](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FRequest "https://developer.mozilla.org/en-US/docs/Web/API/Request") and [Response](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FResponse "https://developer.mozilla.org/en-US/docs/Web/API/Response") API Customize the processing logic for the given route.

Simply put, in a front-end and back-end separation architecture, the client and server interact through API interfaces. This "API interface" has a more formal name in Next.js, which is the routing handler.

In this article, we will explain how to define a routing handler and some common problems encountered when writing routing handlers.

## 1. Define routing handlers

To write a routing handler, you need to define a special file called 'route. js'. (Note that 'route' is not 'router')

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/babbee6771464a4f86b56a6ec8acc6f9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=444&s=212806&e=png&b=171717)

The file must be located in the 'app' directory and can be nested within the 'app' folder. However, it should be noted that 'page. js' and' route. js' cannot coexist at the same level.

It can also be understood that both 'page. js' and' route. js' are essentially responses to routing` Page. js is mainly responsible for rendering the UI, while route. js is mainly responsible for processing requests. If it exists simultaneously, Next.js will not know whose logic to use.

### 1.1. GET request

Let's start by writing GET requests, such as an interface to retrieve a list of articles.

Create a new 'app/app/posts/route. js' file with the following code:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">export async function GET() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">  const res = await fetch(&#39;https://jsonplaceholder.typicode.com/posts&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const data = await res.json()</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">  return NextResponse.json({ data })</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>

Browser Access`http://localhost:3000/api/posts`To view the data returned by the interface:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a067b254ed254d738e7384fcd1a13bb0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=3602&h=1482&s=412488&e=png&b=ffffff)

In this example:

1. We use an 'export' function called 'GET' to define the processing of GET requests. Please note that it is' export 'instead of' export default '
2. We use the NextResponse object of 'next/server' to set the response content, but it is not necessary to use 'NextResponse' here. It is also possible to use 'Response' directly:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export async function GET() {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  const res = await fetch(&#39;https://jsonplaceholder.typicode.com/posts&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="3">  const data = await res.json()</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">  return Response.json({ data })</span>
<span class="code-block-extension-codeLine" data-line-num="6">}</span>
</code></pre>

However, in practical development, it is recommended to use 'NextResponse' because it is a Next.js encapsulation based on 'Response', which is more TypeScript friendly and provides more convenient usage, such as obtaining cookies.

3. We have written the interface in the 'app/app' folder, not because the interface must be placed in a folder named 'api' (different from Pages Router). If your code is written in 'app/posts/route. js', the corresponding interface address is'/posts'. Placing it in the 'api' folder is only for the convenience of distinguishing whether the address is an interface or a page.

### 1.2. Supporting methods

The next. js supports HTTP request methods such as GET, POST, PUT, PATCH, Delete, HEAD, and Options. If an unsupported request method is passed in, the next. js will return ` 405 Do not allow method usage`

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// route.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export async function GET(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export async function HEAD(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6">export async function POST(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">export async function PUT(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">export async function DELETE(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">export async function PATCH(request) {}</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14">// If 'Options' is not defined, Next.js will automatically implement it `OPTIONS`</span>
<span class="code-block-extension-codeLine" data-line-num="15">export async function OPTIONS(request) {}</span>
</code></pre>

Now let's write another POST request to practice our hands.

Continue to modify the 'app/app/posts/route. js' and add the following code:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export async function POST(request) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  const article = await request.json()</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">  return NextResponse.json({</span>
<span class="code-block-extension-codeLine" data-line-num="5">    id: Math.random().toString(36).slice(-8),</span>
<span class="code-block-extension-codeLine" data-line-num="6">    data: article</span>
<span class="code-block-extension-codeLine" data-line-num="7">  }, { status: 201 })</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>

Now let's use Postman to call:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75d5b058673841c3b4f4b9ab75507c2a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1750&h=1030&s=170274&e=png&b=252525)
