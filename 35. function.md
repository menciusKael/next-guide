## 1. fetch

### 1.1. Introduction

Next.js extends the native Web [fetch API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFetch_API "https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API"), which allows you to set your own cache mode for each request. You can call it directly in the server component with `async` and `await`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default async function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  // Requests are cached</span>
<span class="code-block-extension-codeLine" data-line-num="4">  // Similar to Pages Router `getStaticProps`.</span>
<span class="code-block-extension-codeLine" data-line-num="5">  // `force-cache` is the default option, you don't need to specify it</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const staticData = await fetch(`https://...`, { cache: &#39;force-cache&#39; })</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">  // It will be retrieved again every time it is requested.</span>
<span class="code-block-extension-codeLine" data-line-num="9">  // Similar to Pages Router`getServerSideProps`.</span>
<span class="code-block-extension-codeLine" data-line-num="10">  const dynamicData = await fetch(`https://...`, { cache: &#39;no-store&#39; })</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">  // Requests are cached, up to 10s</span>
<span class="code-block-extension-codeLine" data-line-num="13">  // Similar to `getStaticProps` under Pages Router using the `revalidate` option.</span>
<span class="code-block-extension-codeLine" data-line-num="14">  const revalidatedData = await fetch(`https://...`, {</span>
<span class="code-block-extension-codeLine" data-line-num="15">    next: { revalidate: 10 },</span>
<span class="code-block-extension-codeLine" data-line-num="16">  })</span>
<span class="code-block-extension-codeLine" data-line-num="17"></span>
<span class="code-block-extension-codeLine" data-line-num="18">  return <span class="xml">&lt;div&gt;...&lt;/div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="19">}</span>
</code></pre>

It should be noted here that fetch in the browser actually also has a cache option:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">async function postData(url = &#34;&#34;, data = {}) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  const response = await fetch(url, {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    method: &#34;POST&#34;,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    cache: &#34;no-cache&#34;, // *default, no-cache, reload, force-cache, only-if-cached</span>
<span class="code-block-extension-codeLine" data-line-num="5">    body: JSON.stringify(data), </span>
<span class="code-block-extension-codeLine" data-line-num="6">  });</span>
<span class="code-block-extension-codeLine" data-line-num="7">  return response.json();</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>

The fetch cache option in the browser controls the HTTP cache that interacts with the browser, while the fetch cache option we use on the server actually controls Next.js' own caching logic, which will cache these requests for future repeated requests. The specific cache options of these two are also different, which will be discussed next.

### 1.2. fetch(url, options)

#### options.cache

Used to configure Next.js data cache（[Data Cache](https://link.juejin.cn/?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fbuilding-your-application%2Fcaching%23data-cache "https://nextjs.org/docs/app/building-your-application/caching#data-cache")）

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { cache: &#39;force-cache&#39; | &#39;no-store&#39; })</span>
</code></pre>

- `force-cache` is the default value, which means that matching requests are searched from the cache first. When there is no match or the match is out of date, the resource is obtained from the server and the cache is updated.
- `no-store` means that each request is obtained from the server, and the cache is not searched or updated.

If the cache option is not provided, the default is `force-cache`, but if you use dynamic functions (such as cookies()), its default value will be `no-store`.

#### options.next.revalidate

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { next: { revalidate: false | 0 | number } })</span>
</code></pre>

Set resource cache time:

- `false` (default): semantically equivalent to `revalidate: Infinity`, resources are cached indefinitely
- `0`: prevent resources from being cached
- `number`: specify resource cache time, at most `n` seconds

If a single `fetch()` request has a lower `revalidate` value than the `revalidate` configured for a route segment, the revalidate time for the entire route will be reduced. If there are two requests for the same URL under the same route, but with different `revalidate` values, the lower value is used.

For convenience, if `revalidate` is set to a number, there is no need to set the `cache` option. Setting it to `0` will apply `cache: 'no-store'`, and setting it to a positive value will apply `cache: 'force-cache'`. Conflicting configurations such as `{ revalidate: 0, cache: 'force-cache' }` and `{ revalidate: 10, cache: 'no-store' }` will result in an error.

#### options.next.tags

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { next: { tags: [&#39;collection&#39;] } })</span>
</code></pre>

Sets the cache tag of the resource. The data can be revalidated on demand using `revalidateTag`. The maximum length of a custom tag is 256 characters.
