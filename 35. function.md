## 1. fetch

### 1.1. Introduction

Next.js extends the native Web [fetch API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFetch_API "https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API"), which allows you to set your own cache mode for each request. You can call it directly in the server component with `async` and `await`:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default async function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  // Requests are cached</span>
<span class="code-block-extension-codeLine" data-line-num="4">  // Similar to Pages Router `getStaticProps`.</span>
<span class="code-block-extension-codeLine" data-line-num="5">  // `force-cache` is the default option, you don't need to specify it</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const staticData = await fetch(`https://...`, { cache: &#39;force-cache&#39; })</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">  // It will be retrieved again every time it is requested.</span>
<span class="code-block-extension-codeLine" data-line-num="9">  // Similar to Pages Router`getServerSideProps`.</span>
<span class="code-block-extension-codeLine" data-line-num="10">  const dynamicData = await fetch(`https://...`, { cache: &#39;no-store&#39; })</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">  // Requests are cached, up to 10s</span>
<span class="code-block-extension-codeLine" data-line-num="13">  // Similar to `getStaticProps` under Pages Router using the `revalidate` option.</span>
<span class="code-block-extension-codeLine" data-line-num="14">  const revalidatedData = await fetch(`https://...`, {</span>
<span class="code-block-extension-codeLine" data-line-num="15">    next: { revalidate: 10 },</span>
<span class="code-block-extension-codeLine" data-line-num="16">  })</span>
<span class="code-block-extension-codeLine" data-line-num="17"></span>
<span class="code-block-extension-codeLine" data-line-num="18">  return <span class="xml">&lt;div&gt;...&lt;/div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="19">}</span>
</code></pre>

It should be noted here that fetch in the browser actually also has a cache option:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">async function postData(url = &#34;&#34;, data = {}) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  const response = await fetch(url, {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    method: &#34;POST&#34;,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    cache: &#34;no-cache&#34;, // *default, no-cache, reload, force-cache, only-if-cached</span>
<span class="code-block-extension-codeLine" data-line-num="5">    body: JSON.stringify(data), </span>
<span class="code-block-extension-codeLine" data-line-num="6">  });</span>
<span class="code-block-extension-codeLine" data-line-num="7">  return response.json();</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>

The fetch cache option in the browser controls the HTTP cache that interacts with the browser, while the fetch cache option we use on the server actually controls Next.js' own caching logic, which will cache these requests for future repeated requests. The specific cache options of these two are also different, which will be discussed next.

### 1.2. fetch(url, options)

#### options.cache

Used to configure Next.js data cache（[Data Cache](https://link.juejin.cn/?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fbuilding-your-application%2Fcaching%23data-cache "https://nextjs.org/docs/app/building-your-application/caching#data-cache")）

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { cache: &#39;force-cache&#39; | &#39;no-store&#39; })</span>
</code></pre>

- `force-cache` is the default value, which means that matching requests are searched from the cache first. When there is no match or the match is out of date, the resource is obtained from the server and the cache is updated.
- `no-store` means that each request is obtained from the server, and the cache is not searched or updated.

If the cache option is not provided, the default is `force-cache`, but if you use dynamic functions (such as cookies()), its default value will be `no-store`.

#### options.next.revalidate

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { next: { revalidate: false | 0 | number } })</span>
</code></pre>

Set resource cache time:

- `false` (default): semantically equivalent to `revalidate: Infinity`, resources are cached indefinitely
- `0`: prevent resources from being cached
- `number`: specify resource cache time, at most `n` seconds

If a single `fetch()` request has a lower `revalidate` value than the `revalidate` configured for a route segment, the revalidate time for the entire route will be reduced. If there are two requests for the same URL under the same route, but with different `revalidate` values, the lower value is used.

For convenience, if `revalidate` is set to a number, there is no need to set the `cache` option. Setting it to `0` will apply `cache: 'no-store'`, and setting it to a positive value will apply `cache: 'force-cache'`. Conflicting configurations such as `{ revalidate: 0, cache: 'force-cache' }` and `{ revalidate: 10, cache: 'no-store' }` will result in an error.

#### options.next.tags

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">fetch(`https://...`, { next: { tags: [&#39;collection&#39;] } })</span>
</code></pre>

Sets the cache tag of the resource. The data can be revalidated on demand using `revalidateTag`. The maximum length of a custom tag is 256 characters.

## 2. cookies

### 2.1. Introduction

The `cookies` function is used to:

1. Read cookies from incoming requests in server-side components
2. Write cookies from returned requests in Server Action or route handlers

Note: As mentioned many times in previous articles, `cookies()` is a dynamic function because its return value cannot be known in advance. Therefore, using this function in a page or layout will cause the route to be transformed into dynamic rendering.

### 2.2. cookies

#### cookies().get(name)

This method takes a cookie name and returns an object with `name` and `value` properties. If not found, `undefined` is returned. If multiple cookies are matched, the first matching one is returned.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const cookieStore = cookies()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  // If a match is found, the value of theme is{ name: &#39;theme&#39;, value: &#39;xxxx&#39; }</span>
<span class="code-block-extension-codeLine" data-line-num="7">  //If no match is found, the value of theme isundefined</span>
<span class="code-block-extension-codeLine" data-line-num="8">  const theme = cookieStore.get(&#39;theme&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="9">  return &#39;...&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="10">}</span>
</code></pre>

#### cookies().getAll(name)

This method is similar to `get`, but returns all matching `cookies` as an array, or an empty array if no matches are found. If `name` is not specified, all available cookies are returned.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const cookieStore = cookies()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  // If a match is found, the value of theme is [{ name: &#39;theme&#39;, value: &#39;xxxx&#39; }]</span>
<span class="code-block-extension-codeLine" data-line-num="7">  // If no match is found, the value of theme is[]</span>
<span class="code-block-extension-codeLine" data-line-num="8">  const theme = cookieStore.get(&#39;theme&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="9">  return &#39;...&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="10">}</span>
</code></pre>

Another example is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const cookieStore = cookies()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  return cookieStore.getAll().map((cookie) =&gt; (</span>
<span class="code-block-extension-codeLine" data-line-num="7">    <span class="xml">&lt;div key={cookie.name}&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">      &lt;p&gt;Name: {cookie.name}&lt;/p&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="9">      &lt;p&gt;Value: {cookie.value}&lt;/p&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">    &lt;/div&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="11">  ))</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>

#### cookies().has(name)

This method takes a cookie name and returns a Boolean value indicating whether the cookie exists.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const cookiesList = cookies()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  // true | false</span>
<span class="code-block-extension-codeLine" data-line-num="7">  const hasCookie = cookiesList.has(&#39;theme&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="8">  return &#39;...&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>

#### cookies().set(name, value, options)

This method is used to set a cookie.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/actions.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">async function create(data) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  cookies().set(&#39;name&#39;, &#39;lee&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="7">  // or</span>
<span class="code-block-extension-codeLine" data-line-num="8">  cookies().set(&#39;name&#39;, &#39;lee&#39;, { secure: true })</span>
<span class="code-block-extension-codeLine" data-line-num="9">  // or</span>
<span class="code-block-extension-codeLine" data-line-num="10">  cookies().set({</span>
<span class="code-block-extension-codeLine" data-line-num="11">    name: &#39;name&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="12">    value: &#39;lee&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="13">    httpOnly: true,</span>
<span class="code-block-extension-codeLine" data-line-num="14">    path: &#39;/&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="15">  })</span>
<span class="code-block-extension-codeLine" data-line-num="16">}</span>
</code></pre>

In addition to name and value, specific options are passed through [View Source Code](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Fblob%2F7874ad265962dd1659497cbd8f5c71ddceee207b%2Fpackages%2Fnext%2Fsrc%2Fcompiled%2F%2540edge-runtime%2Fcookies%2Findex.js%23L74 "https://github.com/vercel/next.js/blob/7874ad265962dd1659497cbd8f5c71ddceee207b/packages/next/src/compiled/%40edge-runtime/cookies/index.js#L74")It can be seen that there are also domain, expires, httponly, maxage, path, samesite, secure, and priority.

#### Delete cookies

There are many ways to delete cookies:

##### cookies().delete(name)

Delete the cookie with the specified name

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/actions.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export async function create(data) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  cookies().delete(&#39;name&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
</code></pre>

##### cookies().set(name, '')

Sets a cookie with the specified name to an empty value

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/actions.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export async function create(data) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  cookies().set(&#39;name&#39;, &#39;&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
</code></pre>

##### cookies().set(name, value, { maxAge: 0 })

Set maxAge to 0 to expire the cookie immediately

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/actions.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export async function create(data) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  cookies().set(&#39;name&#39;, &#39;value&#39;, { maxAge: 0 })</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
</code></pre>

##### cookies().set(name, value, { expires: timestamp })

Setting expires to a past value will cause the cookie to expire

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/actions.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { cookies } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export async function create(data) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const oneDay = 24 * 60 * 60 * 1000</span>
<span class="code-block-extension-codeLine" data-line-num="7">  cookies().set(&#39;name&#39;, &#39;value&#39;, { expires: Date.now() - oneDay })</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>

#### Testing the effects of deletion

If you want to test these deletion effects:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use client&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { create } from &#39;./action&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export default function Page({ params }) {</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="xml">&lt;form action={create}&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">      &lt;input type=&#34;text&#34; name=&#34;name&#34; /&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">      &lt;button type=&#34;submit&#34;&gt;Submit&lt;/button&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="11">    &lt;/form&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="12">  );</span>
<span class="code-block-extension-codeLine" data-line-num="13">}</span>
</code></pre>

The effect is as follows:

![1113.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fa74c93649545959ec04e3ea0cb5a46~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=864&h=199&s=26031&e=gif&f=8&b=2e2e2e)

## 3. headers

### 3.1. Introduction

The `headers()` function is used to read the incoming HTTP request headers from the server-side component. It extends the [Web Headers API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers"). It is read-only, which means you cannot `set`/`delete` the returned request headers. headers() is a dynamic function like cookies(), and its return value cannot be known in advance. Once used, it will cause the route to switch to dynamic rendering.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { headers } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const headersList = headers()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const referer = headersList.get(&#39;referer&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">  return <span class="xml">&lt;div&gt;Referer: {referer}&lt;/div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>

### 3.2. API

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">const headersList = headers()</span>
</code></pre>

headers() does not accept any parameters and returns a read-only [Web Headers](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers") object, so there are no set, append, delete methods:

- [Headers.entries()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders%2Fentries "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/entries")：With [iterator](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FIteration_protocols "https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols") Returns all key-value pairs in the Headers object in the form of
- [Headers.get()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders%2Fget "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/get")：by [String](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString "https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String") Returns all values ​​of the specified header from the Headers object in the form of
- [Headers.has()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders%2Fhas "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/has")：Returns whether the specified header exists in the Headers object as a Boolean value.
- [Headers.keys()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders%2Fkeys "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/keys")：With [iterator](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FIteration_protocols "https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols")Returns all header names in the Headers object in the form of
- [Headers.values()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHeaders%2Fvalues "https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/values")：With [iterator](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FIteration_protocols "https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols")Returns the values ​​of all existing headers in the Headers object in the form of
- [Headers.forEach()](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FHeaders%2FforEach "https://developer.mozilla.org/en-US/docs/Web/API/Headers/forEach")：Executes a callback function once for each key/value pair in the object

For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { headers } from &#39;next/headers&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">async function getUser() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const headersInstance = headers()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const authorization = headersInstance.get(&#39;authorization&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="7">  // Forwardauthorization header</span>
<span class="code-block-extension-codeLine" data-line-num="8">  const res = await fetch(&#39;...&#39;, {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    headers: { authorization },</span>
<span class="code-block-extension-codeLine" data-line-num="10">  })</span>
<span class="code-block-extension-codeLine" data-line-num="11">  return res.json()</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14">export default async function UserPage() {</span>
<span class="code-block-extension-codeLine" data-line-num="15">  const user = await getUser()</span>
<span class="code-block-extension-codeLine" data-line-num="16">  return <span class="xml">&lt;h1&gt;{user.name}&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span>
</code></pre>

## 4. NextRequest

### 4.1. Introduction

NextRequest extends the [Web Request API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fdocs%2FWeb%2FAPI%2FRequest "https://developer.mozilla.org/docs/Web/API/Request") and provides some convenient methods.

### 4.2. Cookies

Used to read and modify the request [Set-Cookie](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FSet-Cookie "https://developer.mozilla.org/docs/Web/HTTP/Headers/Set-Cookie")Header.

#### set(name, value)

To set cookies:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// The request will have a `Set-Cookie:show-banner=false;path=/home` Header</span>
<span class="code-block-extension-codeLine" data-line-num="2">request.cookies.set(&#39;show-banner&#39;, &#39;false&#39;)</span>
</code></pre>

#### get(name)

Returns the cookie value of the specified name. If not found, returns undefined. If multiple cookies are found, returns the first one:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// { name: &#39;show-banner&#39;, value: &#39;false&#39;, Path: &#39;/home&#39; }</span>
<span class="code-block-extension-codeLine" data-line-num="2">request.cookies.get(&#39;show-banner&#39;)</span>
</code></pre>

#### getAll()

Returns the cookie value of the specified name. If not specified, returns all in array form:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// [</span>
<span class="code-block-extension-codeLine" data-line-num="2">//   { name: &#39;experiments&#39;, value: &#39;new-pricing-page&#39;, Path: &#39;/home&#39; },</span>
<span class="code-block-extension-codeLine" data-line-num="3">//   { name: &#39;experiments&#39;, value: &#39;winter-launch&#39;, Path: &#39;/home&#39; },</span>
<span class="code-block-extension-codeLine" data-line-num="4">// ]</span>
<span class="code-block-extension-codeLine" data-line-num="5">request.cookies.getAll(&#39;experiments&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="6">// Returns all cookie values</span>
<span class="code-block-extension-codeLine" data-line-num="7">request.cookies.getAll()</span>
</code></pre>

#### delete(name)

To delete cookies:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Return true if the deletion was successful, false if nothing was deleted</span>
<span class="code-block-extension-codeLine" data-line-num="2">request.cookies.delete(&#39;experiments&#39;)</span>
</code></pre>

#### has(name)

Determines whether the cookie value exists, returns true if yes, false if no

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">request.cookies.has(&#39;experiments&#39;)</span>
</code></pre>

#### clear()

Remove the `Set-Cookie` header from the request

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">request.cookies.clear()</span>
</code></pre>

### 4.3. nextUrl

Expanded the original [URL API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FURL "https://developer.mozilla.org/zh-CN/docs/Web/API/URL")，Some convenience methods are provided:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Assume the request is /home, pathname is/home</span>
<span class="code-block-extension-codeLine" data-line-num="2">request.nextUrl.pathname</span>
<span class="code-block-extension-codeLine" data-line-num="3">// The request is /home?name=lee, searchParams is{ &#39;name&#39;: &#39;lee&#39; }</span>
<span class="code-block-extension-codeLine" data-line-num="4">request.nextUrl.searchParams</span></code></pre>

## 5. NextResponse

### 5.1. Introduction

NextResponse extends the [Web Response API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fdocs%2FWeb%2FAPI%2FResponse "https://developer.mozilla.org/docs/Web/API/Response") and provides some convenient methods.

### 5.2. cookies

Used to read and change the Set-Cookie header of the response.

#### set(name, value)

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// /home</span>
<span class="code-block-extension-codeLine" data-line-num="2">let response = NextResponse.next()</span>
<span class="code-block-extension-codeLine" data-line-num="3">// set cookie</span>
<span class="code-block-extension-codeLine" data-line-num="4">response.cookies.set(&#39;show-banner&#39;, &#39;false&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="5">// Response 的 Set-Cookie header is `Set-Cookie:show-banner=false;path=/home`</span>
<span class="code-block-extension-codeLine" data-line-num="6">return response</span>
</code></pre>

#### get(name)

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Assume the request is /home</span>
<span class="code-block-extension-codeLine" data-line-num="2">let response = NextResponse.next()</span>
<span class="code-block-extension-codeLine" data-line-num="3">// { name: &#39;show-banner&#39;, value: &#39;false&#39;, Path: &#39;/home&#39; }</span>
<span class="code-block-extension-codeLine" data-line-num="4">response.cookies.get(&#39;show-banner&#39;)</span>
</code></pre>

#### getAll()

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Assume the request is /home</span>
<span class="code-block-extension-codeLine" data-line-num="2">let response = NextResponse.next()</span>
<span class="code-block-extension-codeLine" data-line-num="3">// [</span>
<span class="code-block-extension-codeLine" data-line-num="4">//   { name: &#39;experiments&#39;, value: &#39;new-pricing-page&#39;, Path: &#39;/home&#39; },</span>
<span class="code-block-extension-codeLine" data-line-num="5">//   { name: &#39;experiments&#39;, value: &#39;winter-launch&#39;, Path: &#39;/home&#39; },</span>
<span class="code-block-extension-codeLine" data-line-num="6">// ]</span>
<span class="code-block-extension-codeLine" data-line-num="7">response.cookies.getAll(&#39;experiments&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="8">// Returns all cookie values</span>
<span class="code-block-extension-codeLine" data-line-num="9">response.cookies.getAll()</span>
</code></pre>

#### delete(name)

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Assume the request is /home</span>
<span class="code-block-extension-codeLine" data-line-num="2">let response = NextResponse.next()</span>
<span class="code-block-extension-codeLine" data-line-num="3">// Return true if the deletion was successful, false if nothing was deleted</span>
<span class="code-block-extension-codeLine" data-line-num="4">response.cookies.delete(&#39;experiments&#39;)</span>
</code></pre>

### 5.3. json

Generate a response with the given JSON body:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/api/route.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export async function GET(request) {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  return NextResponse.json({ error: &#39;Internal Server Error&#39; }, { status: 500 })</span>
<span class="code-block-extension-codeLine" data-line-num="6">}</span>
</code></pre>

### 5.4. redirect()

Generate a response that redirects to the new URL:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">return NextResponse.redirect(new URL(&#39;/new&#39;, request.url))</span>
</code></pre>

You can create and change the [URL](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FURL "https://developer.mozilla.org/zh-CN/docs/Web/API/URL") before using the `NextResponse.redirect()` method. For example, you can use `request.nextUrl` to get the current URL and then change it to the redirected URL:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">const loginUrl = new URL(&#39;/login&#39;, request.url)</span>
<span class="code-block-extension-codeLine" data-line-num="4">// Add the ?from=/incoming-url parameter to /login URL</span>
<span class="code-block-extension-codeLine" data-line-num="5">loginUrl.searchParams.set(&#39;from&#39;, request.nextUrl.pathname)</span>
<span class="code-block-extension-codeLine" data-line-num="6">// Redirect to a new URL</span>
<span class="code-block-extension-codeLine" data-line-num="7">return NextResponse.redirect(loginUrl)</span>
</code></pre>

### 5.5. rewrite()

Generate a response rewritten to the specified URL while preserving the original URL:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">// Incoming request: /about, browser displays/about</span>
<span class="code-block-extension-codeLine" data-line-num="4">// Rewrite request: /proxy, browser display/about</span>
<span class="code-block-extension-codeLine" data-line-num="5">return NextResponse.rewrite(new URL(&#39;/proxy&#39;, request.url))</span>
</code></pre>

### 5.6. next()

Commonly used in middleware to return early and continue routing:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">return NextResponse.next()</span>
</code></pre>

It is also possible to forward `headers` when generating a response.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div><span class="code-block-extension-lang">javascript</span></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import { NextResponse } from &#39;next/server&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">const newHeaders = new Headers(request.headers)</span>
<span class="code-block-extension-codeLine" data-line-num="4">// add new header</span>
<span class="code-block-extension-codeLine" data-line-num="5">newHeaders.set(&#39;x-version&#39;, &#39;123&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="6">// return new headers</span>
<span class="code-block-extension-codeLine" data-line-num="7">return NextResponse.next({</span>
<span class="code-block-extension-codeLine" data-line-num="8">  request: {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    headers: newHeaders,</span>
<span class="code-block-extension-codeLine" data-line-num="10">  },</span>
<span class="code-block-extension-codeLine" data-line-num="11">})</span></code></pre>
