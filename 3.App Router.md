## Preface

Router is an important part of Next.js application. In Next.js, routing determines how a page is rendered or how a request is returned.

Next.js has two routing solutions. The previous solution is called "Pages Router" and the current solution is called "App Router". The two solutions are currently compatible and can be used in Next.js.

As of v13.4, App Router has become the default routing scheme and is recommended for new Next.js projects.

In this article, we will learn how to define routes and common file conventions under App Router.

## 1. file-system

The routing of Next.js is based on the file system, that is to say, a file can be a route. For example, if you create an `index.js` file in the `pages` directory, it will be directly mapped to the `/` routing address:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// pages/index.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import React from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3">export default () =&gt; <span class="xml">&lt;h1&gt;Hello world&lt;/h1&gt;</span></span>
</code></pre>

Create an `about.js` file in the `pages` directory, which will map directly to the `/about` routing address:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// pages/about.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import React from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3">export default () =&gt; <span class="xml">&lt;h1&gt;About us&lt;/h1&gt;</span></span>
</code></pre>

## 2. From Pages Router to App Router

Now if you open the project created using `create-next-app`, you will find that there is no `pages` directory by default. Check the Next.js version in `packages.json`, if the version number is greater than `13.4`, then you are right!

Next.js uses a new routing mode - App Router since v13. The previous routing model we called "Pages Router" still exists in order to maintain progressive updates. Starting from v13.4, App Router has officially entered the stabilization stage. App Router has stronger functions, better performance, and more flexible code organization. Let us use the new routing mode in the future!

But what is the difference between the two? Next.js and why upgrade to App Router? Knowing this and knowing why, let us briefly trace it back. In the past, when we declared a route, we only needed to create a file in the `pages` directory. The previous directory structure was similar to:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">└── pages</span>
<span class="code-block-extension-codeLine" data-line-num="2">    ├── index.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">    ├── about.js</span>
<span class="code-block-extension-codeLine" data-line-num="4">    └── more.js</span>
</code></pre>

This method has a drawback, that is, all js files in the `pages` directory will be treated as routing files, which means that components cannot be written in the `pages` directory, which is not in line with developers' usage habits. (Of course, there are many other problems with Pages Router, but the content we have introduced so far is too little. In order not to increase the cost of understanding for everyone, we will not say more)

After upgrading to the new App Router, the directory structure now looks like:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">src/</span>
<span class="code-block-extension-codeLine" data-line-num="2">└── app</span>
<span class="code-block-extension-codeLine" data-line-num="3">    ├── page.js </span>
<span class="code-block-extension-codeLine" data-line-num="4">    ├── layout.js</span>
<span class="code-block-extension-codeLine" data-line-num="5">    ├── template.js</span>
<span class="code-block-extension-codeLine" data-line-num="6">    ├── loading.js</span>
<span class="code-block-extension-codeLine" data-line-num="7">    ├── error.js</span>
<span class="code-block-extension-codeLine" data-line-num="8">    └── not-found.js</span>
<span class="code-block-extension-codeLine" data-line-num="9">    ├── about</span>
<span class="code-block-extension-codeLine" data-line-num="10">    │   └── page.js</span>
<span class="code-block-extension-codeLine" data-line-num="11">    └── more</span>
<span class="code-block-extension-codeLine" data-line-num="12">        └── page.js</span>
</code></pre>

After using the new mode, you will find that there are many more files under `app`. The names of these files are not random ones made by me, but some special files agreed by Next.js. From the names of these files, you can also understand the functions implemented by the files, such as layout (layout.js), template (template.js), loading status (loading.js), error handling (error.js), 404 (not- found.js) etc.

Simply put, App Router has formulated more complete specifications to make the code better organized and managed. As for the specific functions and introduction of these files, don't worry, we will slowly expand on this article.

## 3. Using Pages Router

Of course, you can also continue to use Pages Router. If you want to use Pages Router, you only need to create a `pages` folder in the `src` directory or create a `pages` folder in the root directory. The JS files therein will be treated as Pages Router for processing.

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e3628b5a76b4bdc87b423b377f80946~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=444&s=212184&e=png&b=141414)

Note, however, that although the two can coexist, App Router takes precedence over Pages Router. And if both resolve to the same URL, a build error will result.

Note: When you search in the official Next.js documentation, there will be App and Pages options in the upper left corner, which correspond to App Router and Pages Router:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab940655f6c14e428a72c91b1f727681~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1382&h=586&s=71771&e=png&b=040404)

Because the two routing modes are used very differently, be careful to choose the correct routing mode when searching.

## 4. Using App Router

### 4.1. Define routes（Routes）

Now let's start formally learning App Router.

The first is to define the route. The folder is used to define the route. Each folder represents a routing fragment that corresponds to a URL fragment. To create nested routes, you only need to create nested folders. For example, the routing address corresponding to the `app/dashboard/settings` directory in the figure below is `/dashboard/settings`:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c35a76b0027c4e9fb5bc0d5807f479f4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=594&s=339521&e=png&b=141414)

### 4.2. Define page（Pages）

So how to ensure that this route can be accessed? You need to create a special file called `page.js`. As for why it is called `page.js`? In addition to `page` having the meaning of "page", you can understand it as a convention or specification. (If you are a Next.js developer, you can also agree to `index.js` or even `any.js`!)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/40820ff4957244899288d7534bd4c525~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=687&s=314397&e=png&b=171717)

In the example above:

- `app/page.js` corresponds to route `/`
- `app/dashboard/page.js` corresponds to route `/dashboard`
- `app/dashboard/settings/page.js` corresponds to route `/dashboard/settings`
- Because there is no `page.js` file in the `analytics` directory, there is no corresponding route. This file can be used to store components, style sheets, images, or other files.

**Of course, it’s not just `.js` files. Next.js supports React and TypeScript by default, so `.js`, `.jsx`, and `.tsx` are all acceptable.**

So how to write the code of `page.js`? The most common is to display the UI, such as:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return <span class="xml">&lt;h1&gt;Hello, Next.js!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

Visit `http://localhost:3000/`, the effect is as follows:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78d38b112da542488c81d5412fc407ab~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=556&h=200&s=19870&e=png&b=000000)

View code and effects online：[CodeSandbox Pages](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Fobjective-ellis-ywn8jd%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt475kks00073b6iw2cbcpjg%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt475kkr00023b6ihi25h458%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt475kkr00043b6i9lkjph4n%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt475kks00063b6i9l5o6xnw%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt475kkr00023b6ihi25h458%252522%25253A%25257B%252522id%252522%25253A%252522clt475kkr00023b6ihi25h458%252522%25252C%252522tabs%252522%25253A%25255B%25255D%25257D%25252C%252522clt475kks00063b6i9l5o6xnw%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt475kkr00053b6i8y93zpk4%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252F%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt475kks00063b6i9l5o6xnw%252522%25252C%252522activeTabId%252522%25253A%252522clt475kkr00053b6i8y93zpk4%252522%25257D%25252C%252522clt475kkr00043b6i9lkjph4n%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt475kkr00033b6i40hrddok%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt475kkr00043b6i9lkjph4n%252522%25252C%252522activeTabId%252522%25253A%252522clt475kkr00033b6i40hrddok%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/objective-ellis-ywn8jd?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt475kks00073b6iw2cbcpjg%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt475kkr00023b6ihi25h458%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt475kkr00043b6i9lkjph4n%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt475kks00063b6i9l5o6xnw%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt475kkr00023b6ihi25h458%2522%253A%257B%2522id%2522%253A%2522clt475kkr00023b6ihi25h458%2522%252C%2522tabs%2522%253A%255B%255D%257D%252C%2522clt475kks00063b6i9l5o6xnw%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt475kkr00053b6i8y93zpk4%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252F%2522%257D%255D%252C%2522id%2522%253A%2522clt475kks00063b6i9l5o6xnw%2522%252C%2522activeTabId%2522%253A%2522clt475kkr00053b6i8y93zpk4%2522%257D%252C%2522clt475kkr00043b6i9lkjph4n%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt475kkr00033b6i40hrddok%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt475kkr00043b6i9lkjph4n%2522%252C%2522activeTabId%2522%253A%2522clt475kkr00033b6i40hrddok%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

### 4.3. Define layout（Layouts）

Layout refers to the UI shared by multiple pages. During navigation, the layout will retain state, remain interactive, and will not re-render, such as the side navigation bar used to implement the backend management system.

To define a layout, you need to create a new file named `layout.js`, which exports a React component by default, which should receive a `children` prop, `chidren` represents the child layout (if any) or child page.

For example, we create a new directory and file as shown below:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a7872449f6e4c6fb1808f518db7783f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=606&s=295670&e=png&b=151515)

The relevant code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/layout.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function DashboardLayout({</span>
<span class="code-block-extension-codeLine" data-line-num="3">  children,</span>
<span class="code-block-extension-codeLine" data-line-num="4">}) {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="6">    <span class="xml">&lt;section&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">      &lt;nav&gt;nav&lt;/nav&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="8">      {children}</span>
<span class="code-block-extension-codeLine" data-line-num="9">    &lt;/section&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">  )</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return <span class="xml">&lt;h1&gt;Hello, Dashboard!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

When accessing `/dashboard`, the effect is as follows:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43c72c2017354f1e9c292c2bbb9aaa40~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=710&h=268&s=27102&e=png&b=000000)

Among them, `nav` comes from `app/dashboard/layout.js`, `Hello, Dashboard!` comes from `app/dashboard/page.js`

**You can find that if there are layout.js and page.js in the same folder, page will be passed into layout as the children parameter. In other words, layout will wrap pages at the same level.**

`app/dashboard/settings/page.js` code show as below：

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/settings/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return <span class="xml">&lt;h1&gt;Hello, Settings!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

When accessing `/dashboard/settings`, the effect is as follows:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53456de28a684fe3902eb2ce5f4c07a0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=808&h=266&s=29753&e=png&b=000000)

Among them, `nav` comes from `app/dashboard/layout.js`, `Hello, Settings!` comes from `app/dashboard/settings/page.js`

**You can find: The layout supports nesting** ，`app/dashboard/settings/page.js` will use the contents of the two layouts `app/layout.js` and `app/dashboard/layout.js`, but because we did not write in `app/layout.js` Enter the content that can be displayed, so it is not reflected in the picture.

View code and effects online：[CodeSandbox Layouts](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Flayouts-v3csx2%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt489j2g00073b6h88j62aog%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt489j2g00023b6he9lxbh9s%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt489j2g00043b6h2v7dpi6i%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt489j2g00063b6hmqcdputt%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt489j2g00023b6he9lxbh9s%252522%25253A%25257B%252522id%252522%25253A%252522clt489j2g00023b6he9lxbh9s%252522%25252C%252522tabs%252522%25253A%25255B%25255D%25257D%25252C%252522clt489j2g00063b6hmqcdputt%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt489j2g00053b6hi3oec3fe%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252Fdashboard%25252Fsettings%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt489j2g00063b6hmqcdputt%252522%25252C%252522activeTabId%252522%25253A%252522clt489j2g00053b6hi3oec3fe%252522%25257D%25252C%252522clt489j2g00043b6h2v7dpi6i%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt489j2g00033b6h5p3d7t5v%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt489j2g00043b6h2v7dpi6i%252522%25252C%252522activeTabId%252522%25253A%252522clt489j2g00033b6h5p3d7t5v%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/layouts-v3csx2?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt489j2g00073b6h88j62aog%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt489j2g00023b6he9lxbh9s%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt489j2g00043b6h2v7dpi6i%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt489j2g00063b6hmqcdputt%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt489j2g00023b6he9lxbh9s%2522%253A%257B%2522id%2522%253A%2522clt489j2g00023b6he9lxbh9s%2522%252C%2522tabs%2522%253A%255B%255D%257D%252C%2522clt489j2g00063b6hmqcdputt%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt489j2g00053b6hi3oec3fe%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252Fdashboard%252Fsettings%2522%257D%255D%252C%2522id%2522%253A%2522clt489j2g00063b6hmqcdputt%2522%252C%2522activeTabId%2522%253A%2522clt489j2g00053b6hi3oec3fe%2522%257D%252C%2522clt489j2g00043b6h2v7dpi6i%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt489j2g00033b6h5p3d7t5v%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt489j2g00043b6h2v7dpi6i%2522%252C%2522activeTabId%2522%253A%2522clt489j2g00033b6h5p3d7t5v%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

#### root layout（Root Layout）

Layouts support nesting, and the top-level layout is called Root Layout, which is `app/layout.js`. It will apply to all routes. In addition, this layout is a bit special.

The `layout.js` code created by default using `create-next-app` is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/layout.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import &#39;./globals.css&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { Inter } from &#39;next/font/google&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">const inter = Inter({ subsets: [&#39;latin&#39;] })</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">export const metadata = {</span>
<span class="code-block-extension-codeLine" data-line-num="8">  title: &#39;Create Next App&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="9">  description: &#39;Generated by create next app&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="10">}</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">export default function RootLayout({ children }) {</span>
<span class="code-block-extension-codeLine" data-line-num="13">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="14">    <span class="xml">&lt;html lang=&#34;en&#34;&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="15">      &lt;body className={inter.className}&gt;{children}&lt;/body&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="16">    &lt;/html&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="17">  )</span>
<span class="code-block-extension-codeLine" data-line-num="18">}</span>
<span class="code-block-extension-codeLine" data-line-num="19"></span>
</code></pre>

in:

1. The `app` directory must contain the root layout, that is, the `app/layout.js` file is required.
2. The root layout must contain `html` and `body` tags, other layouts cannot contain these tags. If you want to change these tags, it is not recommended to modify them directly
3. You can use [Routing Group] to create multiple root layouts.
4. The default root layout is [server component] and cannot be set as a client component.

### 4.4. Define templates (Templates)

Templates are similar to layouts in that they are also passed into each sublayout or page. But it won't maintain state like layout.

The template will create an instance for each child when routing is switched. This means that when the user jumps between routes that share a template, the component instance will be remounted and the DOM elements will be recreated without retaining state. This sounds a bit abstract, but it doesn’t matter. Let’s look at how the template is written first, and then write a demo and you will understand.

To define a template, you need to create a new file named `template.js`, which exports a React component by default, which receives a `children` prop. Let's write a sample code.

Create a new `template.js` file in the `app` directory:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e19139c038fe4c528f89874541928670~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=444&s=216678&e=png&b=151515)

`template.js` code show as below：

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/template.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function Template({ children }) {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return <span class="xml">&lt;div&gt;{children}&lt;/div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

You will find that this usage is exactly the same as layout. The biggest difference between them is the maintenance of state. If there are both `template.js` and `layout.js` in the same directory, the final output effect is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&lt;Layout&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="2">  {/* The template needs to be given a unique key */}</span>
<span class="code-block-extension-codeLine" data-line-num="3">  &lt;Template key={routeParam}&gt;{children}&lt;/Template&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="4">&lt;/Layout&gt;</span>
</code></pre>

In other words, `layout` will wrap `template`, and `template` will wrap `page`.

In some cases, templates are more suitable than layouts:

- Functions that rely on useEffect and useState, such as recording the number of page visits (maintaining the state will not record the number of visits when routing is switched), user feedback form (refilling each time), etc.
- Change the default behavior of the framework. For example, Suspense within the layout will only display the fallback UI once when the layout is loaded, and will not be displayed when switching pages. But using templates, fallback will be displayed every time the route switches

#### Layout VS Template

In order to help everyone better understand layout and templates, we write a demo to show the characteristics of the two.

The project directory is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">app</span>
<span class="code-block-extension-codeLine" data-line-num="2">└─ dashboard</span>
<span class="code-block-extension-codeLine" data-line-num="3">   ├─ layout.js</span>
<span class="code-block-extension-codeLine" data-line-num="4">   ├─ page.js</span>
<span class="code-block-extension-codeLine" data-line-num="5">   ├─ template.js</span>
<span class="code-block-extension-codeLine" data-line-num="6">   ├─ about</span>
<span class="code-block-extension-codeLine" data-line-num="7">   │  └─ page.js</span>
<span class="code-block-extension-codeLine" data-line-num="8">   └─ settings</span>
<span class="code-block-extension-codeLine" data-line-num="9">      └─ page.js</span>
</code></pre>

The `dashboard/layout.js` code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use client&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">import { useState } from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4">import Link from &#39;next/link&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6">export default function Layout({ children }) {</span>
<span class="code-block-extension-codeLine" data-line-num="7">  const [count, setCount] = useState(0)</span>
<span class="code-block-extension-codeLine" data-line-num="8">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="xml">&lt;&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="10">      &lt;div&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="11">        &lt;Link href=&#34;/dashboard/about&#34;&gt;About&lt;/Link&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="12">        &lt;br/&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="13">        &lt;Link href=&#34;/dashboard/settings&#34;&gt;Settings&lt;/Link&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="14">      &lt;/div&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="15">      &lt;h1&gt;Layout {count}&lt;/h1&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="16">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="17">        Increment</span>
<span class="code-block-extension-codeLine" data-line-num="18">      &lt;/button&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="19">      {children}</span>
<span class="code-block-extension-codeLine" data-line-num="20">    &lt;/&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="21">  )</span>
<span class="code-block-extension-codeLine" data-line-num="22">}</span>
</code></pre>

`dashboard/template.js` code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use client&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">import { useState } from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export default function Template({ children }) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const [count, setCount] = useState(0)</span>
<span class="code-block-extension-codeLine" data-line-num="7">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="xml">&lt;&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">      &lt;h1&gt;Template {count}&lt;/h1&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="11">        Increment</span>
<span class="code-block-extension-codeLine" data-line-num="12">      &lt;/button&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="13">      {children}</span>
<span class="code-block-extension-codeLine" data-line-num="14">    &lt;/&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="15">  )</span>
<span class="code-block-extension-codeLine" data-line-num="16">}</span>
</code></pre>

`dashboard/page.js`code show as below:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  return <span class="xml">&lt;h1&gt;Hello, Dashboard!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
</code></pre>

`dashboard/about/page.js`code show as below:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  return <span class="xml">&lt;h1&gt;Hello, About!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
</code></pre>

`dashboard/settings/page.js`code show as below:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  return <span class="xml">&lt;h1&gt;Hello, Settings!&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
</code></pre>

The final display effect is as follows (some style processing has been done to facilitate differentiation):

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d33ef3073ed46ce9f234880630246dd~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2558&h=1624&s=480097&e=png&b=000000)

Now click on the two `Increment` buttons and the counting will start. Just click on the number, and then click `About` or `Settings` to switch routes. You will find that the number after Layout has not changed, and the number after Template is reset to 0. This is called state maintenance.

![10.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/461a47c030d64fc7890e35de58feb950~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=450&h=342&s=33835&e=gif&f=54&b=010101)

Note: Of course, if you refresh the page, the numbers after Layout and Template will definitely be reset to 0.

View code and effects online：[CodeSandbox Templates VS Layouts](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Ftemplates-h25kzz%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt48u2gb00073b6hi8zrj7z5%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt48u2gb00023b6h6qaf1m82%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt48u2gb00043b6hvw4el4sp%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt48u2gb00063b6ht7hvjihq%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt48u2gb00023b6h6qaf1m82%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt48u2ga00013b6hrwr6p06f%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522FILE%252522%25252C%252522filepath%252522%25253A%252522%25252FREADME.md%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt48u2gb00023b6h6qaf1m82%252522%25252C%252522activeTabId%252522%25253A%252522clt48u2ga00013b6hrwr6p06f%252522%25257D%25252C%252522clt48u2gb00063b6ht7hvjihq%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt48u2gb00053b6ho6d4dyg7%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252Fdashboard%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt48u2gb00063b6ht7hvjihq%252522%25252C%252522activeTabId%252522%25253A%252522clt48u2gb00053b6ho6d4dyg7%252522%25257D%25252C%252522clt48u2gb00043b6hvw4el4sp%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt48u2gb00033b6hgzgomtf5%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt48u2gb00043b6hvw4el4sp%252522%25252C%252522activeTabId%252522%25253A%252522clt48u2gb00033b6hgzgomtf5%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/templates-h25kzz?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt48u2gb00073b6hi8zrj7z5%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt48u2gb00023b6h6qaf1m82%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt48u2gb00043b6hvw4el4sp%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt48u2gb00063b6ht7hvjihq%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt48u2gb00023b6h6qaf1m82%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt48u2ga00013b6hrwr6p06f%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252FREADME.md%2522%257D%255D%252C%2522id%2522%253A%2522clt48u2gb00023b6h6qaf1m82%2522%252C%2522activeTabId%2522%253A%2522clt48u2ga00013b6hrwr6p06f%2522%257D%252C%2522clt48u2gb00063b6ht7hvjihq%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt48u2gb00053b6ho6d4dyg7%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252Fdashboard%2522%257D%255D%252C%2522id%2522%253A%2522clt48u2gb00063b6ht7hvjihq%2522%252C%2522activeTabId%2522%253A%2522clt48u2gb00053b6ho6d4dyg7%2522%257D%252C%2522clt48u2gb00043b6hvw4el4sp%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt48u2gb00033b6hgzgomtf5%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt48u2gb00043b6hvw4el4sp%2522%252C%2522activeTabId%2522%253A%2522clt48u2gb00033b6hgzgomtf5%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

### 4.5. Define loading interface（Loading UI）

Now we have understood the functions of `page.js`, `layout.js`, and `template.js`, but there are more special files than that. App Router provides `loading.js` for displaying the loading interface.

This feature is implemented with the help of React's `Suspense` API. The effect it achieves is that when a routing change occurs, the fallback UI is immediately displayed, and the data is displayed after the loading is completed.

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-jsx code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// Displayed when the ProfilePage component is in the loading phase Spinner</span>
<span class="code-block-extension-codeLine" data-line-num="2">&lt;Suspense fallback={<span class="xml">&lt;Spinner /&gt;</span>}&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="3">  <span class="xml">&lt;ProfilePage /&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">&lt;/Suspense&gt;</span>
</code></pre>

When I first come into contact with the concept of Suspense, I often have a doubt, that is - "Where do I control the closing of the fallback UI?"

Even on the React official website, there is not much mention of the implementation logic behind it. But in fact, the implementation logic is very simple. Simply put, ProfilePage will throw a data loading promise, Suspense will capture this promise, append a then function, and replace the fallback UI in the then function. When the data is loaded, the promise enters the resolve state, the then function is executed, and the fallback UI is updated and replaced.

Now that we understand the principle, let’s take a look at how to write this `loading.js`. We create a new `loading.js` in the `dashboard` directory。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a410face8c0443bda0bba48a3fa4a602~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=606&s=292947&e=png&b=151515)

`loading.js`The code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/loading.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">export default function DashboardLoading() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  return <span class="xml">&lt;&gt;Loading dashboard...&lt;/&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>

Same level `page.js` The code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">async function getData() {</span>
<span class="code-block-extension-codeLine" data-line-num="3">  await new Promise((resolve) =&gt; setTimeout(resolve, 3000))</span>
<span class="code-block-extension-codeLine" data-line-num="4">  return {</span>
<span class="code-block-extension-codeLine" data-line-num="5">    message: &#39;Hello, Dashboard!&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="6">  }</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
<span class="code-block-extension-codeLine" data-line-num="8">export default async function DashboardPage(props) {</span>
<span class="code-block-extension-codeLine" data-line-num="9">  const { message } = await getData()</span>
<span class="code-block-extension-codeLine" data-line-num="10">  return <span class="xml">&lt;h1&gt;{message}&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>

No other code is needed, the loading effect is achieved:

![11.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cd31cc361fb418f9657597e6916cc59~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=450&h=342&s=7964&e=gif&f=9&b=000000)

View code and effects online：[CodeSandbox Loading](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Floading-yw7zlg%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt4b2khv00073b6hu9pjxkod%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt4b2khv00023b6hl69ez1j6%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt4b2khv00043b6hupnzd9jd%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt4b2khv00063b6his95k772%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt4b2khv00023b6hl69ez1j6%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00013b6hs9i6fr2l%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522FILE%252522%25252C%252522filepath%252522%25253A%252522%25252FREADME.md%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00023b6hl69ez1j6%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00013b6hs9i6fr2l%252522%25257D%25252C%252522clt4b2khv00063b6his95k772%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00053b6hmql3m7p5%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252Fdashboard%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00063b6his95k772%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00053b6hmql3m7p5%252522%25257D%25252C%252522clt4b2khv00043b6hupnzd9jd%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00033b6h55d7v2oi%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00043b6hupnzd9jd%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00033b6h55d7v2oi%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/loading-yw7zlg?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt4b2khv00073b6hu9pjxkod%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt4b2khv00023b6hl69ez1j6%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt4b2khv00043b6hupnzd9jd%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt4b2khv00063b6his95k772%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt4b2khv00023b6hl69ez1j6%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00013b6hs9i6fr2l%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252FREADME.md%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00023b6hl69ez1j6%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00013b6hs9i6fr2l%2522%257D%252C%2522clt4b2khv00063b6his95k772%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00053b6hmql3m7p5%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252Fdashboard%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00063b6his95k772%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00053b6hmql3m7p5%2522%257D%252C%2522clt4b2khv00043b6hupnzd9jd%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00033b6h55d7v2oi%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00043b6hupnzd9jd%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00033b6h55d7v2oi%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

It's that simple. The key is that `page.js` exports an async function.

The implementation principle of `loading.js` is to wrap `page.js` and the following children with `<Suspense>`. Because `page.js` exports an async function, Suspense can capture the promise of data loading, thereby closing the loading component.

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/804284470c16423eb3d3d2d4510996ce~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=766&s=442672&e=png&b=191919)

Of course, to achieve the loading effect, it is not necessary to export an async function. You can also use React’s `use` function. Now we create a new `about` directory under `dashboard` and create a new `page.js` file in it.

`/dashboard/about/page.js` The code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// /dashboard/about/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { use } from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">async function getData() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  await new Promise((resolve) =&gt; setTimeout(resolve, 5000))</span>
<span class="code-block-extension-codeLine" data-line-num="6">  return {</span>
<span class="code-block-extension-codeLine" data-line-num="7">    message: &#39;Hello, About!&#39;,</span>
<span class="code-block-extension-codeLine" data-line-num="8">  }</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
<span class="code-block-extension-codeLine" data-line-num="10"></span>
<span class="code-block-extension-codeLine" data-line-num="11">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="12">  const {message} = use(getData())</span>
<span class="code-block-extension-codeLine" data-line-num="13">  return <span class="xml">&lt;h1&gt;{message}&lt;/h1&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="14">}</span>
</code></pre>

The loading effect is also implemented:

![12.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa3f3e67b3e348348c03a6492e4581f7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=450&h=342&s=6554&e=gif&f=6&b=000000)

View code and effects online：[CodeSandbox Loading](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Floading-yw7zlg%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt4b2khv00073b6hu9pjxkod%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt4b2khv00023b6hl69ez1j6%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt4b2khv00043b6hupnzd9jd%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt4b2khv00063b6his95k772%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt4b2khv00023b6hl69ez1j6%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00013b6hs9i6fr2l%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522FILE%252522%25252C%252522filepath%252522%25253A%252522%25252FREADME.md%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00023b6hl69ez1j6%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00013b6hs9i6fr2l%252522%25257D%25252C%252522clt4b2khv00063b6his95k772%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00053b6hmql3m7p5%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252Fdashboard%25252Fabout%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00063b6his95k772%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00053b6hmql3m7p5%252522%25257D%25252C%252522clt4b2khv00043b6hupnzd9jd%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4b2khv00033b6h55d7v2oi%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4b2khv00043b6hupnzd9jd%252522%25252C%252522activeTabId%252522%25253A%252522clt4b2khv00033b6h55d7v2oi%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/loading-yw7zlg?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt4b2khv00073b6hu9pjxkod%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt4b2khv00023b6hl69ez1j6%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt4b2khv00043b6hupnzd9jd%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt4b2khv00063b6his95k772%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt4b2khv00023b6hl69ez1j6%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00013b6hs9i6fr2l%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252FREADME.md%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00023b6hl69ez1j6%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00013b6hs9i6fr2l%2522%257D%252C%2522clt4b2khv00063b6his95k772%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00053b6hmql3m7p5%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252Fdashboard%252Fabout%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00063b6his95k772%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00053b6hmql3m7p5%2522%257D%252C%2522clt4b2khv00043b6hupnzd9jd%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4b2khv00033b6h55d7v2oi%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt4b2khv00043b6hupnzd9jd%2522%252C%2522activeTabId%2522%253A%2522clt4b2khv00033b6h55d7v2oi%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

If you want to implement a separate loading effect for `/dashboard/about`, then write another `loading.js` in the `about` directory.

If there are both `layout.js`, `template.js` and `loading.js` in the same folder, what is their hierarchical relationship?

For the hierarchical issues of these special files, we can solve it directly with one picture:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a0551d59d32b486e8f869e0e6ca8f157~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=641&s=327102&e=png&b=1c1c1c)

### 4.6. Define error handling（Error Handling）

Let’s talk about the special file `error.js`. As the name suggests, it is used to create a display UI when an error occurs.

Its implementation relies on React’s [Error Boundary](https://link.juejin.cn/?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FComponent%23catching-rendering-errors-with-an-error-boundary "https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary") Function. To put it simply, it wraps page.js and children with a layer of `ErrorBoundary`.

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2005b09883440cdab2d9a2be0217883~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=901&s=497446&e=png&b=1a1a1a)

Let's write a demo to demonstrate the effect of `error.js`. Create a new `error.js` in the `dashboard` directory. The directory effect is as follows:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b16665406e384c35870c4aa68ea9875a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=606&s=293046&e=png&b=151515)

`dashboard/error.js`code show as below:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use client&#39; // 错误组件必须是客户端组件</span>
<span class="code-block-extension-codeLine" data-line-num="2">// dashboard/error.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import { useEffect } from &#39;react&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export default function Error({ error, reset }) {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  useEffect(() =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="7">    console.error(error)</span>
<span class="code-block-extension-codeLine" data-line-num="8">  }, [error])</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="11">    <span class="xml">&lt;div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="12">      &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="13">      &lt;button</span>
<span class="code-block-extension-codeLine" data-line-num="14">        onClick={</span>
<span class="code-block-extension-codeLine" data-line-num="15">          </span>
<span class="code-block-extension-codeLine" data-line-num="16">          () =&gt; reset()</span>
<span class="code-block-extension-codeLine" data-line-num="17">        }</span>
<span class="code-block-extension-codeLine" data-line-num="18">      &gt;</span>
<span class="code-block-extension-codeLine" data-line-num="19">        Try again</span>
<span class="code-block-extension-codeLine" data-line-num="20">      &lt;/button&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="21">    &lt;/div&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="22">  )</span>
<span class="code-block-extension-codeLine" data-line-num="23">}</span>
</code></pre>

To trigger the Error error, the code of the sibling `page.js` is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#34;use client&#34;;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// dashboard/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">import React from &#34;react&#34;;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  const [error, setError] = React.useState(false);</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">  const handleGetError = () =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    setError(true);</span>
<span class="code-block-extension-codeLine" data-line-num="10">  };</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="13">    <span class="xml">&lt;&gt;{error ? Error() : &lt;button onClick={handleGetError}&gt;Get Error&lt;/button&gt;}&lt;/&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="14">  );</span>
<span class="code-block-extension-codeLine" data-line-num="15">}</span>
</code></pre>

The effect is as follows:

![13.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e09190375f63426fbe4ac89c5f8e246f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=450&h=342&s=15591&e=gif&f=28&b=000000)

Sometimes errors are temporary and just retrying can resolve the issue. So Next.js will pass in the `reset` function in the component exported by `error.js` to help try to recover from the error. This function will trigger the re-rendering of the content within the error boundary. If successful, the re-rendered content will be displayed instead.

View code and effects online：[CodeSandbox Error](https://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fdevbox%2Ferror-l6gr2j%3Flayout%3D%25257B%252522sidebarPanel%252522%25253A%252522EXPLORER%252522%25252C%252522rootPanelGroup%252522%25253A%25257B%252522direction%252522%25253A%252522horizontal%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522id%252522%25253A%252522ROOT_LAYOUT%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522UNKNOWN%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522clt4bdci200073b6h91twyt7o%252522%25252C%252522sizes%252522%25253A%25255B70%25252C30%25255D%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522EDITOR%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522EDITOR%252522%25252C%252522id%252522%25253A%252522clt4bdci200023b6h529g4j8y%252522%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522direction%252522%25253A%252522horizontal%252522%25252C%252522id%252522%25253A%252522SHELLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522SHELLS%252522%25252C%252522id%252522%25253A%252522clt4bdci200043b6hd7knjpp1%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25257D%25252C%25257B%252522type%252522%25253A%252522PANEL_GROUP%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522direction%252522%25253A%252522vertical%252522%25252C%252522id%252522%25253A%252522DEVTOOLS%252522%25252C%252522panels%252522%25253A%25255B%25257B%252522type%252522%25253A%252522PANEL%252522%25252C%252522contentType%252522%25253A%252522DEVTOOLS%252522%25252C%252522id%252522%25253A%252522clt4bdci200063b6h8vy2xj52%252522%25257D%25255D%25252C%252522sizes%252522%25253A%25255B100%25255D%25257D%25255D%25252C%252522sizes%252522%25253A%25255B50%25252C50%25255D%25257D%25252C%252522tabbedPanels%252522%25253A%25257B%252522clt4bdci200023b6h529g4j8y%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4bdci100013b6h9h1wm21z%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522FILE%252522%25252C%252522filepath%252522%25253A%252522%25252FREADME.md%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4bdci200023b6h529g4j8y%252522%25252C%252522activeTabId%252522%25253A%252522clt4bdci100013b6h9h1wm21z%252522%25257D%25252C%252522clt4bdci200063b6h8vy2xj52%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4bdci200053b6hxtxruqpi%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_PORT%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25252C%252522port%252522%25253A3000%25252C%252522path%252522%25253A%252522%25252Fdashboard%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4bdci200063b6h8vy2xj52%252522%25252C%252522activeTabId%252522%25253A%252522clt4bdci200053b6hxtxruqpi%252522%25257D%25252C%252522clt4bdci200043b6hd7knjpp1%252522%25253A%25257B%252522tabs%252522%25253A%25255B%25257B%252522id%252522%25253A%252522clt4bdci200033b6hwspjksxq%252522%25252C%252522mode%252522%25253A%252522permanent%252522%25252C%252522type%252522%25253A%252522TASK_LOG%252522%25252C%252522taskId%252522%25253A%252522dev%252522%25257D%25255D%25252C%252522id%252522%25253A%252522clt4bdci200043b6hd7knjpp1%252522%25252C%252522activeTabId%252522%25253A%252522clt4bdci200033b6hwspjksxq%252522%25257D%25257D%25252C%252522showDevtools%252522%25253Atrue%25252C%252522showShells%252522%25253Atrue%25252C%252522showSidebar%252522%25253Atrue%25252C%252522sidebarPanelSize%252522%25253A15%25257D "https://codesandbox.io/p/devbox/error-l6gr2j?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522UNKNOWN%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522clt4bdci200073b6h91twyt7o%2522%252C%2522sizes%2522%253A%255B70%252C30%255D%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522EDITOR%2522%252C%2522id%2522%253A%2522clt4bdci200023b6h529g4j8y%2522%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522SHELLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522SHELLS%2522%252C%2522id%2522%253A%2522clt4bdci200043b6hd7knjpp1%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522direction%2522%253A%2522vertical%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522contentType%2522%253A%2522DEVTOOLS%2522%252C%2522id%2522%253A%2522clt4bdci200063b6h8vy2xj52%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clt4bdci200023b6h529g4j8y%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4bdci100013b6h9h1wm21z%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522FILE%2522%252C%2522filepath%2522%253A%2522%252FREADME.md%2522%257D%255D%252C%2522id%2522%253A%2522clt4bdci200023b6h529g4j8y%2522%252C%2522activeTabId%2522%253A%2522clt4bdci100013b6h9h1wm21z%2522%257D%252C%2522clt4bdci200063b6h8vy2xj52%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4bdci200053b6hxtxruqpi%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522dev%2522%252C%2522port%2522%253A3000%252C%2522path%2522%253A%2522%252Fdashboard%2522%257D%255D%252C%2522id%2522%253A%2522clt4bdci200063b6h8vy2xj52%2522%252C%2522activeTabId%2522%253A%2522clt4bdci200053b6hxtxruqpi%2522%257D%252C%2522clt4bdci200043b6hd7knjpp1%2522%253A%257B%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clt4bdci200033b6hwspjksxq%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522dev%2522%257D%255D%252C%2522id%2522%253A%2522clt4bdci200043b6hd7knjpp1%2522%252C%2522activeTabId%2522%253A%2522clt4bdci200033b6hwspjksxq%2522%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showShells%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D")

Remember the hierarchy issue discussed in the previous section? Let’s review:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eeb2e4b635f0473785c0ba9d79df01b6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1600&h=641&s=327102&e=png&b=1c1c1c)

You will find a problem from this picture: because `Layout` and `Template` are outside `ErrorBoundary`, this means that the error boundary cannot capture errors in `layout.js` or `template.js` at the same level. If you want to catch errors in a specific layout or template, you need to catch them in the parent's `error.js`.

Then the question comes, if we have reached the top level, how to catch errors in the root layout? In order to solve this problem, Next.js provides the `global-error.js` file. When using it, you need to place it in the `app` directory.

`global-error.js` will wrap the entire application, and when it is triggered, it will replace the contents of the root layout. Therefore, the `<html>` and `<body>` tags must also be defined in `global-error.js`.

The sample code of `global-error.js` is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">&#39;use client&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2">// app/global-error.js</span>
<span class="code-block-extension-codeLine" data-line-num="3">export default function GlobalError({ error, reset }) {</span>
<span class="code-block-extension-codeLine" data-line-num="4">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="xml">&lt;html&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">      &lt;body&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="7">        &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="8">        &lt;button onClick={() =&gt; reset()}&gt;Try again&lt;/button&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="9">      &lt;/body&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">    &lt;/html&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="11">  )</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>

Note: `global-error.js` is used to handle errors in the root layout and root template. `app/error.js` is recommended to be written.

### 4.7. Define 404 page

Finally, let’s talk about a special file - `not-found.js`. As the name suggests, the content displayed when the route does not exist.

The default not-found effect of the Next.js project is as follows:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92bd888fdae94703885dcec24825c2d6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=872&h=340&s=18455&e=png&b=000000)

If you want to replace this effect, you only need to create a new `not-found.js` in the `app` directory. The code example is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">import Link from &#39;next/link&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">export default function NotFound() {</span>
<span class="code-block-extension-codeLine" data-line-num="4">  return (</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="xml">&lt;div&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">      &lt;h2&gt;Not Found&lt;/h2&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="7">      &lt;p&gt;Could not find requested resource&lt;/p&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="8">      &lt;Link href=&#34;/&#34;&gt;Return Home&lt;/Link&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="9">    &lt;/div&gt;</span>
<span class="code-block-extension-codeLine" data-line-num="10">  )</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>

The effect of not-found will be changed to:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aff4d53c41c94d55b597f8d924f13187~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=806&h=326&s=37554&e=png&b=000000)

Something important to note about `app/not-found.js` is that it can only be triggered by two situations:

1. When the component throws the notFound function
2. When routing addresses do not match

So `app/not-found.js` can modify the style of the default 404 page. However, if `not-found.js` is placed in any subfolder, it can only be triggered manually by the `notFound` function. For example:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// /dashboard/blog/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { notFound } from &#39;next/navigation&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">export default function Page() {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  notFound()</span>
<span class="code-block-extension-codeLine" data-line-num="6">  return <span class="xml">&lt;&gt;&lt;/&gt;</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
</code></pre>

When the notFound function is executed, it will be handled by the nearest not-found.js. But if you directly access a route that does not exist, it will be handled by `app/not-found.js`.

Corresponding to actual development, when we request data for a user or data for an article, if the data does not exist, we can directly throw out the `notFound` function and render the customized `not-found.js` interface. The sample code is as follows:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">// app/dashboard/blog/[id]/page.js</span>
<span class="code-block-extension-codeLine" data-line-num="2">import { notFound } from &#39;next/navigation&#39;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">async function fetchUser(id) {</span>
<span class="code-block-extension-codeLine" data-line-num="5">  const res = await fetch(&#39;https://...&#39;)</span>
<span class="code-block-extension-codeLine" data-line-num="6">  if (!res.ok) return undefined</span>
<span class="code-block-extension-codeLine" data-line-num="7">  return res.json()</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">export default async function Profile({ params }) {</span>
<span class="code-block-extension-codeLine" data-line-num="11">  const user = await fetchUser(params.id)</span>
<span class="code-block-extension-codeLine" data-line-num="12"></span>
<span class="code-block-extension-codeLine" data-line-num="13">  if (!user) {</span>
<span class="code-block-extension-codeLine" data-line-num="14">    notFound()</span>
<span class="code-block-extension-codeLine" data-line-num="15">  }</span>
<span class="code-block-extension-codeLine" data-line-num="16"></span>
<span class="code-block-extension-codeLine" data-line-num="17">  // ...</span>
<span class="code-block-extension-codeLine" data-line-num="18">}</span>
</code></pre>

Note: We will also talk about the concept of "routing group" later. When `app/not-found.js` is used together with routing groups, problems may occur.

## summary

Congratulations, you have completed the study of this section!

This section focuses on the Next.js file system-based routing solution App Router, and introduces `page.js` for defining pages, `layout.js` for defining layouts, and `template.js` for defining templates. `loading.js` that defines the loading interface, `error.js` that defines error handling, and `not-found.js` that defines the 404 page. Now look at the directory structure of App Router:

<pre><div class="code-block-extension-header"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">src/</span>
<span class="code-block-extension-codeLine" data-line-num="2">└── app</span>
<span class="code-block-extension-codeLine" data-line-num="3">    ├── page.js </span>
<span class="code-block-extension-codeLine" data-line-num="4">    ├── layout.js</span>
<span class="code-block-extension-codeLine" data-line-num="5">    ├── template.js</span>
<span class="code-block-extension-codeLine" data-line-num="6">    ├── loading.js</span>
<span class="code-block-extension-codeLine" data-line-num="7">    ├── error.js</span>
<span class="code-block-extension-codeLine" data-line-num="8">    └── not-found.js</span>
<span class="code-block-extension-codeLine" data-line-num="9">    ├── about</span>
<span class="code-block-extension-codeLine" data-line-num="10">    │   └── page.js</span>
<span class="code-block-extension-codeLine" data-line-num="11">    └── more</span>
<span class="code-block-extension-codeLine" data-line-num="12">        └── page.js</span>
</code></pre>

> Simply put, App Router has formulated more complete specifications to make the code better organized and managed.

Do you have a deeper understanding of this? However, this is only a small part of the powerful routing capabilities of Next.js. Let’s continue learning in the next article.
